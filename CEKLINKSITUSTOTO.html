<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINK SITUSTOTO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“Š</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #ff6b35;
            --primary-dark: #e55a2b;
            --secondary: #ffd166;
            --accent: #ef476f;
            --dark-bg: #0f0f23;
            --darker-bg: #090914;
            --card-bg: rgba(21, 21, 43, 0.85);
            --card-border: #2a2a4a;
            --text: #ffffff;
            --text-muted: #d1d5db;
            --success: #06d6a0;
            --warning: #ffd166;
            --danger: #ef476f;
            --info: #118ab2;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--dark-bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            background-image: url('https://cdn.areabermain.club/assets/cdn/az6/2024/11/12/20241112/1bf09710db2abd6dd6777465b7864e83/situstoto-bg-1.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: -1;
        }

        /* Background Animation */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            opacity: 0.5;
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            opacity: 0.1;
            animation: float 20s infinite linear;
        }

        .shape:nth-child(1) {
            width: 300px;
            height: 300px;
            background: linear-gradient(135deg, var(--primary), transparent);
            top: 10%;
            left: 5%;
            animation-delay: 0s;
        }

        .shape:nth-child(2) {
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, var(--secondary), transparent);
            top: 60%;
            right: 10%;
            animation-delay: -5s;
            animation-duration: 25s;
        }

        .shape:nth-child(3) {
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, var(--accent), transparent);
            bottom: 20%;
            left: 20%;
            animation-delay: -10s;
            animation-duration: 30s;
        }

        @keyframes float {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg);
            }
            25% {
                transform: translate(20px, 30px) rotate(90deg);
            }
            50% {
                transform: translate(-15px, 20px) rotate(180deg);
            }
            75% {
                transform: translate(10px, -15px) rotate(270deg);
            }
        }

        .grid-lines {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255, 107, 53, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 107, 53, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 30s linear infinite;
        }

        @keyframes gridMove {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 50px 50px;
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header dengan animasi - RATA TENGAH */
        .header {
            background: linear-gradient(135deg, rgba(21, 21, 43, 0.9), rgba(15, 15, 35, 0.9));
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px 40px;
            margin-bottom: 20px;
            border: 1px solid var(--card-border);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            animation: slideDown 0.8s ease-out;
            text-align: center;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            animation: shimmer 3s infinite;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: inline-block;
            animation: textGlow 2s infinite alternate;
            text-align: center;
            width: 100%;
        }

        .header p {
            font-size: 1.1rem;
            color: var(--text-muted);
            max-width: 800px;
            line-height: 1.6;
            margin: 0 auto;
            text-align: center;
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .logo {
            font-size: 3rem;
            animation: pulse 2s infinite;
        }

        /* Status Box */
        .status {
            background: rgba(21, 21, 43, 0.8);
            border-left: 4px solid var(--primary);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            backdrop-filter: blur(5px);
            border: 1px solid var(--card-border);
            animation: fadeIn 0.5s ease-out;
            transition: all 0.3s;
        }

        .status:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.2);
        }

        .status.success {
            border-left-color: var(--success);
        }

        .status.error {
            border-left-color: var(--danger);
        }

        .status-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-icon {
            font-size: 1.8rem;
            min-width: 40px;
        }

        .ip-info {
            font-size: 0.9rem;
            color: var(--text-muted);
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ip-info i {
            color: var(--info);
        }

        .connection-method {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 10px;
            background: rgba(255, 107, 53, 0.2);
            color: var(--primary);
        }

        .connection-method.direct {
            background: rgba(6, 214, 160, 0.2);
            color: var(--success);
        }

        /* Stats Cards - DIKECILKAN */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: linear-gradient(145deg, var(--card-bg), rgba(21, 21, 43, 0.7));
            border-radius: 14px;
            padding: 20px 15px;
            text-align: center;
            border: 1px solid var(--card-border);
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.6s ease-out;
            backdrop-filter: blur(5px);
        }

        .stat-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transition: left 0.7s;
        }

        .stat-box:hover::before {
            left: 100%;
        }

        .stat-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        /* ====================== SEARCH BAR ====================== */
        .search-container {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 10px 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            border: 1px solid var(--card-border);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            position: relative;
        }

        .search-container:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.3);
        }

        .search-icon {
            color: var(--text-muted);
            font-size: 1.1rem;
            margin-right: 12px;
        }

        .search-input {
            background: transparent;
            border: none;
            color: var(--text);
            font-size: 1rem;
            width: 100%;
            outline: none;
            font-family: inherit;
        }

        .search-input::placeholder {
            color: rgba(209, 213, 219, 0.5);
        }

        .clear-search-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        .clear-search-btn:hover {
            background: rgba(255, 107, 53, 0.2);
            color: var(--primary);
            transform: rotate(90deg);
        }

        /* Group Container - dengan indikator selesai */
        .group-container {
            background: linear-gradient(145deg, var(--card-bg), rgba(21, 21, 43, 0.8));
            border-radius: 18px;
            border: 1px solid var(--card-border);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            margin-bottom: 15px;
            overflow: hidden;
            animation: fadeIn 0.8s ease-out;
            transition: all 0.3s ease;
            max-height: 70px;
            position: relative;
            backdrop-filter: blur(5px);
        }
        
        /* Class for filtering */
        .group-container.filtered-hidden {
            display: none;
        }
        
        /* Class to force expand during search */
        .group-container.force-expanded {
            max-height: none;
        }
        .group-container.force-expanded .group-content {
            display: block;
        }

        .group-container.completed {
            border: 2px solid var(--success);
            box-shadow: 0 15px 35px rgba(6, 214, 160, 0.2);
        }

        .group-container.completed::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--success), #0da371);
        }

        .group-container.minimized {
            max-height: 70px;
            overflow: hidden;
        }

        .group-container.expanded {
            max-height: none;
        }

        .group-container.minimized .group-content {
            display: none;
        }

        .group-header {
            background: linear-gradient(90deg, rgba(255, 107, 53, 0.2), rgba(255, 209, 102, 0.2));
            padding: 18px 22px;
            border-bottom: 1px solid var(--card-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s;
        }

        .group-container.completed .group-header {
            background: linear-gradient(90deg, rgba(6, 214, 160, 0.2), rgba(255, 209, 102, 0.3));
        }

        .group-header:hover {
            background: linear-gradient(90deg, rgba(255, 107, 53, 0.3), rgba(255, 209, 102, 0.3));
        }

        .group-container.completed .group-header:hover {
            background: linear-gradient(90deg, rgba(6, 214, 160, 0.3), rgba(255, 209, 102, 0.4));
        }

        .group-header.minimized {
            border-bottom: none;
        }

        .group-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .group-container.completed .group-title {
            color: var(--success);
        }

        .group-title i {
            color: var(--secondary);
            transition: transform 0.3s;
        }

        .group-container.completed .group-title i {
            color: var(--success);
        }

        .group-container.minimized .group-title i {
            transform: rotate(-90deg);
        }

        .group-stats {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .group-stat {
            background: rgba(21, 21, 43, 0.6);
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
            border: 1px solid rgba(255, 107, 53, 0.3);
        }

        .group-container.completed .group-stat {
            border-color: rgba(6, 214, 160, 0.3);
        }

        .completed-badge {
            background: var(--success) !important;
            color: white !important;
            border: 1px solid var(--success) !important;
            animation: pulse 2s infinite;
        }

        .group-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        /* Minimize Button */
        .minimize-btn {
            background: rgba(255, 107, 53, 0.2);
            border: 1px solid rgba(255, 107, 53, 0.3);
            color: var(--text);
            width: 34px;
            height: 34px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
        }

        .group-container.completed .minimize-btn {
            background: rgba(6, 214, 160, 0.2);
            border: 1px solid rgba(6, 214, 160, 0.3);
        }

        .minimize-btn:hover {
            background: var(--primary);
            transform: rotate(90deg);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }

        .group-container.completed .minimize-btn:hover {
            background: var(--success);
            box-shadow: 0 5px 15px rgba(6, 214, 160, 0.4);
        }

        .group-container.minimized .minimize-btn {
            transform: rotate(180deg);
        }

        .group-container.minimized .minimize-btn:hover {
            transform: rotate(270deg);
        }

        /* Group Content */
        .group-content {
            max-height: 450px;
            overflow-y: auto;
            transition: all 0.5s ease;
        }

        .group-container.minimized .group-content {
            max-height: 0;
            overflow: hidden;
        }

        /* Buttons */
        .buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
            backdrop-filter: blur(5px);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.7s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.5);
        }

        .btn:active {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #0da371);
        }

        .btn-success:hover {
            box-shadow: 0 10px 25px rgba(6, 214, 160, 0.5);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent), #e53e3e);
        }

        .btn-accent:hover {
            box-shadow: 0 10px 25px rgba(239, 71, 111, 0.5);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        /* Control Buttons */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: rgba(21, 21, 43, 0.6);
            border-radius: 12px;
            border: 1px solid var(--card-border);
            backdrop-filter: blur(5px);
        }

        .controls-left, .controls-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .control-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 107, 53, 0.2);
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            border: 1px solid rgba(255, 107, 53, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .control-btn:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }

        /* Links Table */
        .links-table {
            width: 100%;
            border-collapse: collapse;
            color: var(--text);
        }

        .links-table th {
            padding: 16px 18px;
            text-align: left;
            font-weight: 600;
            color: var(--text);
            border-bottom: 2px solid var(--card-border);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: rgba(21, 21, 43, 0.6);
        }

        .group-container.completed .links-table th {
            background: rgba(6, 214, 160, 0.1);
        }

        .links-table td {
            padding: 14px 18px;
            border-bottom: 1px solid rgba(42, 42, 74, 0.5);
            transition: background 0.3s;
        }
        
        /* Highlight for search results */
        .search-highlight {
            background-color: rgba(255, 209, 102, 0.3);
            border-radius: 4px;
            padding: 2px 4px;
            color: var(--secondary);
            font-weight: bold;
        }

        .links-table tr {
            transition: all 0.3s;
        }

        .links-table tr:hover {
            background: rgba(255, 107, 53, 0.1);
            transform: scale(1.005);
        }

        .group-container.completed .links-table tr:hover {
            background: rgba(6, 214, 160, 0.1);
        }

        .url-cell {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .url-cell a {
            color: var(--secondary);
            text-decoration: none;
            transition: color 0.3s;
            position: relative;
            padding-left: 20px;
        }

        .url-cell a::before {
            content: 'ðŸ”—';
            position: absolute;
            left: 0;
            opacity: 0.7;
        }

        .url-cell a:hover {
            color: var(--primary);
            text-decoration: underline;
        }

        .group-container.completed .url-cell a {
            color: var(--success);
        }

        .action-cell {
            white-space: nowrap;
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 7px 14px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 107, 53, 0.2);
            color: var(--text);
            cursor: pointer;
            margin-right: 8px;
            transition: all 0.3s;
            font-weight: 500;
            border: 1px solid rgba(255, 107, 53, 0.3);
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .action-btn:hover {
            background: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }

        .group-container.completed .action-btn {
            background: rgba(6, 214, 160, 0.2);
            border: 1px solid rgba(6, 214, 160, 0.3);
        }

        .group-container.completed .action-btn:hover {
            background: var(--success);
            box-shadow: 0 5px 15px rgba(6, 214, 160, 0.4);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .copy-btn {
            background: rgba(255, 209, 102, 0.2);
            border: 1px solid rgba(255, 209, 102, 0.3);
        }

        .copy-btn:hover {
            background: var(--secondary);
        }

        .copy-btn.copied {
            background: var(--success) !important;
            color: white !important;
            border-color: var(--success) !important;
        }

        /* New button for reopen */
        .reopen-btn {
            background: rgba(17, 138, 178, 0.2);
            border: 1px solid rgba(17, 138, 178, 0.3);
        }
        
        .reopen-btn:hover {
            background: var(--info);
        }
        
        /* Loading Animation */
        .loading {
            text-align: center;
            padding: 60px;
            background: rgba(21, 21, 43, 0.8);
            border-radius: 20px;
            border: 1px solid var(--card-border);
            backdrop-filter: blur(5px);
        }

        .spinner {
            width: 70px;
            height: 70px;
            border: 5px solid rgba(255, 107, 53, 0.2);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            margin: 0 auto 25px;
            animation: spin 1s linear infinite, pulse 2s infinite;
        }

        .loading p {
            font-size: 1.2rem;
            color: var(--text-muted);
        }

        .loading-method {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 107, 53, 0.1);
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Animations */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from { 
                opacity: 0; 
                transform: translateY(-30px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        @keyframes shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: 200px 0; }
        }

        @keyframes textGlow {
            0% { text-shadow: 0 0 10px rgba(255, 107, 53, 0.5); }
            100% { text-shadow: 0 0 20px rgba(255, 107, 53, 0.8), 0 0 30px rgba(255, 107, 53, 0.6); }
        }

        /* Progress Bar dengan teks yang jelas */
        .progress-container {
            width: 100%;
            background: rgba(21, 21, 43, 0.7);
            border-radius: 12px;
            margin: 20px 0;
            overflow: hidden;
            display: none;
            border: 1px solid var(--card-border);
            height: 36px;
            position: relative;
            backdrop-filter: blur(5px);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 12px;
            width: 0%;
            transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: visible;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding-left: 15px;
            color: white;
            font-weight: 600;
            font-size: 13px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .progress-text {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text);
            font-weight: 600;
            font-size: 13px;
            z-index: 1;
            pointer-events: none;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmerProgress 1.5s infinite;
        }

        @keyframes shimmerProgress {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
            background: rgba(21, 21, 43, 0.8);
            border-radius: 18px;
            backdrop-filter: blur(5px);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 25px;
            margin-top: 30px;
            color: var(--text-muted);
            font-size: 0.85rem;
            border-top: 1px solid rgba(42, 42, 74, 0.5);
            background: rgba(21, 21, 43, 0.6);
            border-radius: 12px;
            backdrop-filter: blur(5px);
        }

        .footer a {
            color: var(--secondary);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .stat-box {
                padding: 15px 10px;
            }

            .stat-value {
                font-size: 1.8rem;
            }

            .stat-icon {
                font-size: 1.8rem;
            }

            .buttons {
                justify-content: center;
            }

            .btn {
                flex: 1;
                min-width: 180px;
                justify-content: center;
                padding: 12px 20px;
            }

            .controls {
                flex-direction: column;
                gap: 15px;
                padding: 12px;
            }

            .controls-left, .controls-right {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }

            .group-header {
                flex-direction: column;
                gap: 12px;
                text-align: center;
                padding: 15px;
            }

            .group-stats {
                justify-content: center;
                flex-wrap: wrap;
            }

            .group-actions {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }

            .links-table {
                display: block;
                overflow-x: auto;
            }

            .progress-container {
                height: 32px;
            }

            .progress-bar {
                font-size: 11px;
            }

            .progress-text {
                font-size: 11px;
            }

            .logo {
                font-size: 2.5rem;
            }
            
            .action-cell {
                flex-direction: column;
                gap: 5px;
            }
            
            .action-btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .stats {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .btn {
                min-width: 100%;
            }
        }
        
        /* Tambahan untuk notifikasi error yang lebih baik */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            max-width: 300px;
            transform: translateX(120%);
            transition: transform 0.3s ease-out;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, var(--success), #0da371);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger), #e53e3e);
        }

        .notification.info {
            background: linear-gradient(135deg, var(--info), #0a6c85);
        }

        .notification.warning {
            background: linear-gradient(135deg, var(--warning), #e6ac00);
        }
        
        /* Tambahan untuk retry button */
        .retry-btn {
            background: linear-gradient(135deg, var(--warning), #e6ac00);
            color: var(--dark-bg);
            font-weight: 600;
        }
        
        .retry-btn:hover {
            box-shadow: 0 10px 25px rgba(255, 209, 102, 0.5);
        }

        /* Connection Status Indicator */
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .connection-status.online {
            background: rgba(6, 214, 160, 0.2);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .connection-status.offline {
            background: rgba(239, 71, 111, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .connection-status i {
            font-size: 1rem;
        }
        
        /* Modal for URL format selection */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease-out;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(145deg, var(--card-bg), rgba(21, 21, 43, 0.9));
            border-radius: 18px;
            border: 1px solid var(--card-border);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            animation: slideDown 0.3s ease-out;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--card-border);
            padding-bottom: 15px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        .modal-body {
            margin-bottom: 25px;
        }

        .format-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .format-option {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 12px;
            background: rgba(21, 21, 43, 0.6);
            border: 1px solid var(--card-border);
            cursor: pointer;
            transition: all 0.3s;
        }

        .format-option:hover {
            background: rgba(255, 107, 53, 0.1);
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .format-option.selected {
            background: rgba(255, 107, 53, 0.2);
            border-color: var(--primary);
        }

        .format-option input[type="radio"] {
            margin-right: 15px;
            width: 20px;
            height: 20px;
            accent-color: var(--primary);
        }

        .format-label {
            flex: 1;
        }

        .format-name {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .format-description {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .format-example {
            margin-top: 8px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.85rem;
            color: var(--secondary);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn-cancel {
            background: rgba(21, 21, 43, 0.6);
            border: 1px solid var(--card-border);
        }

        .btn-cancel:hover {
            background: rgba(21, 21, 43, 0.8);
            border-color: var(--text-muted);
        }

        /* Dropdown for URL format selection */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: var(--card-bg);
            min-width: 200px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1000;
            border-radius: 8px;
            border: 1px solid var(--card-border);
            overflow: hidden;
            animation: fadeIn 0.3s ease-out;
        }

        .dropdown-content.show {
            display: block;
        }

        .dropdown-item {
            color: var(--text);
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .dropdown-item:hover {
            background-color: rgba(255, 107, 53, 0.2);
        }

        .dropdown-item.selected {
            background-color: rgba(255, 107, 53, 0.3);
        }

        .dropdown-item i {
            margin-right: 8px;
            width: 16px;
        }
        
        /* ====================== MOBILE OPTIMIZATIONS ====================== */
        
        /* Mobile Navigation */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, rgba(21, 21, 43, 0.95), rgba(15, 15, 35, 0.95));
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--card-border);
            z-index: 1000;
            padding: 10px 0;
        }
        
        .mobile-nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        
        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 5px 10px;
            color: var(--text-muted);
            text-decoration: none;
            transition: color 0.3s;
            font-size: 0.75rem;
        }
        
        .mobile-nav-item.active {
            color: var(--primary);
        }
        
        .mobile-nav-item i {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        /* Mobile Header */
        .mobile-header {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, rgba(21, 21, 43, 0.95), rgba(15, 15, 35, 0.95));
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--card-border);
            z-index: 1000;
            padding: 10px 15px;
        }
        
        .mobile-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .mobile-logo {
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .mobile-menu-btn {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* Mobile Stats Card */
        .mobile-stats-card {
            display: none;
            background: linear-gradient(145deg, var(--card-bg), rgba(21, 21, 43, 0.8));
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--card-border);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .mobile-stats-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text);
        }
        
        .mobile-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .mobile-stat-item {
            background: rgba(21, 21, 43, 0.6);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }
        
        .mobile-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .mobile-stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        /* Mobile Group Card */
        .mobile-group-card {
            display: none;
            background: linear-gradient(145deg, var(--card-bg), rgba(21, 21, 43, 0.8));
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--card-border);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        /* Search Highlight for Mobile */
        .mobile-link-url.highlight {
            background-color: rgba(255, 209, 102, 0.3);
            color: var(--secondary);
            font-weight: bold;
            border-radius: 4px;
        }

        .mobile-group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .mobile-group-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .mobile-group-stats {
            display: flex;
            gap: 8px;
        }
        
        .mobile-group-stat {
            background: rgba(21, 21, 43, 0.6);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .mobile-group-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .mobile-group-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .mobile-group-btn.primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .mobile-group-btn.success {
            background: linear-gradient(135deg, var(--success), #0da371);
            color: white;
        }
        
        .mobile-group-btn.accent {
            background: linear-gradient(135deg, var(--accent), #e53e3e);
            color: white;
        }
        
        .mobile-link-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .mobile-link-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(42, 42, 74, 0.5);
        }
        
        .mobile-link-url {
            flex: 1;
            font-size: 0.8rem;
            color: var(--secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding-right: 10px;
        }
        
        .mobile-link-actions {
            display: flex;
            gap: 5px;
        }
        
        .mobile-link-btn {
            padding: 5px 8px;
            border: none;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            background: rgba(255, 107, 53, 0.2);
            color: var(--text);
            transition: all 0.3s;
        }
        
        .mobile-link-btn:hover {
            background: var(--primary);
        }
        
        .mobile-link-btn.copy {
            background: rgba(255, 209, 102, 0.2);
        }
        
        .mobile-link-btn.copy:hover {
            background: var(--secondary);
        }
        
        /* Mobile Floating Action Button */
        .mobile-fab {
            display: none;
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
            cursor: pointer;
            z-index: 999;
            font-size: 1.5rem;
            transition: all 0.3s;
        }
        
        .mobile-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.6);
        }
        
        /* Mobile Pull to Refresh */
        .mobile-pull-refresh {
            display: none;
            position: fixed;
            top: -60px;
            left: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(135deg, rgba(21, 21, 43, 0.95), rgba(15, 15, 35, 0.95));
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--card-border);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
            transition: top 0.3s;
        }
        
        .mobile-pull-refresh.active {
            top: 0;
        }
        
        .mobile-pull-refresh-text {
            color: var(--text);
            font-size: 0.9rem;
        }
        
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            /* Hide desktop elements */
            .header, .stats, .controls, .buttons, .group-container {
                display: none;
            }
            
            /* Show mobile elements */
            .mobile-header, .mobile-nav, .mobile-stats-card, .mobile-group-card, .mobile-fab, .mobile-pull-refresh, .search-container {
                display: flex;
            }
            
            /* Adjust container for mobile */
            .container {
                padding: 70px 15px 80px;
            }
            
            /* Mobile loading */
            .loading {
                padding: 40px 20px;
            }
            
            .spinner {
                width: 50px;
                height: 50px;
            }
            
            .loading p {
                font-size: 1rem;
            }
            
            /* Mobile notification */
            .notification {
                top: 70px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
            
            /* Mobile connection status */
            .connection-status {
                bottom: 80px;
                right: 10px;
                left: 10px;
                justify-content: center;
            }
            
            /* Mobile modal */
            .modal-content {
                width: 95%;
                padding: 20px;
            }
            
            .modal-title {
                font-size: 1.2rem;
            }
            
            .format-option {
                padding: 12px;
            }
            
            .format-name {
                font-size: 1rem;
            }
            
            .format-description {
                font-size: 0.8rem;
            }
            
            .format-example {
                font-size: 0.75rem;
            }
        }
        
        /* Touch-friendly interactions */
        @media (hover: none) and (pointer: coarse) {
            .mobile-group-btn, .mobile-link-btn, .mobile-fab {
                min-height: 44px;
                min-width: 44px;
            }
            
            .mobile-nav-item {
                padding: 8px 5px;
            }
            
            .mobile-group-header {
                padding: 5px 0;
            }
        }
        
        /* Fireworks Effect */
        #fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            overflow: hidden;
            z-index: -1;
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: fireworkLaunch 1.5s ease-out forwards;
        }

        .firework-particle {
            position: absolute;
            width: 3px;
            height: 3px;
            border-radius: 50%;
            animation: explode 1s ease-out forwards;
        }

        @keyframes fireworkLaunch {
            0% {
                transform: translateY(100vh) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(20vh) scale(0.5);
                opacity: 0.8;
            }
        }

        @keyframes explode {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--x), var(--y)) scale(0);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
   <script>
 $('<style>img.dragonball{width:1000px;position:absolute;text-align:center;z-index:-1;right:0;transform:scaleX(-1);top:300px}img.dragonball1{width:1000px;position:absolute;text-align:center;z-index:-1;left:0;top:300px}</style><div><img alt=""class=dragonball src=https://cdn.areabermain.club/assets/cdn/az6/2025/12/10/20251210/425ef3813133385fa54cb26c972c9c9b/zeuskuu-ezgif-com-optimize.webp> <img alt=""class=dragonball1 src=https://cdn.areabermain.club/assets/cdn/az6/2025/12/10/20251210/425ef3813133385fa54cb26c972c9c9b/zeuskuu-ezgif-com-optimize.webp></div>').insertBefore($('.navbar.navbar-fixed-top'));
</script>

<!-- Fireworks Container -->
<div id="fireworks"></div>

<script>
document.addEventListener("DOMContentLoaded", function () {

    const fireworksContainer = document.getElementById("fireworks");
    const colors = ['#ff6b35', '#ffd166', '#ef476f', '#06d6a0', '#118ab2', '#f72585', '#7209b7', '#3a0ca3'];
    
    // Create firework function
    function createFirework() {
        const x = Math.random() * window.innerWidth;
        const y = Math.random() * window.innerHeight * 0.5; // Upper half of screen
        
        // Create launching firework
        const firework = document.createElement("div");
        firework.classList.add("firework");
        firework.style.left = `${x}px`;
        firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        
        fireworksContainer.appendChild(firework);
        
        // Create explosion after launch animation
        setTimeout(() => {
            // Remove the launching firework
            firework.remove();
            
            // Create explosion particles
            const particleCount = 30 + Math.floor(Math.random() * 20);
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement("div");
                particle.classList.add("firework-particle");
                
                // Random color for each particle
                const color = colors[Math.floor(Math.random() * colors.length)];
                particle.style.backgroundColor = color;
                particle.style.boxShadow = `0 0 6px 2px ${color}`;
                
                // Position at explosion point
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                
                // Random explosion direction
                const angle = (Math.PI * 2 * i) / particleCount;
                const velocity = 50 + Math.random() * 100;
                const xMove = Math.cos(angle) * velocity;
                const yMove = Math.sin(angle) * velocity;
                
                // Set CSS variables for animation
                particle.style.setProperty('--x', `${xMove}px`);
                particle.style.setProperty('--y', `${yMove}px`);
                
                fireworksContainer.appendChild(particle);
                
                // Remove particle after animation
                setTimeout(() => {
                    particle.remove();
                }, 1000);
            }
        }, 1500);
    }
    
    // Create initial fireworks
    for (let i = 0; i < 5; i++) {
        setTimeout(() => createFirework(), i * 300);
    }
    
    // Create periodic fireworks
    setInterval(() => {
        createFirework();
        
        // Sometimes create multiple fireworks at once
        if (Math.random() > 0.7) {
            setTimeout(() => createFirework(), 200);
        }
    }, 2000);
});
</script>
    <!-- Background Animations -->
    <div class="bg-animation">
        <div class="floating-shapes">
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
        </div>
        <div class="grid-lines"></div>
    </div>

    <!-- Mobile Header -->
    <div class="mobile-header">
        <div class="mobile-header-content">
            <div class="mobile-logo">ðŸ“Š</div>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>

    <!-- Mobile Pull to Refresh -->
    <div class="mobile-pull-refresh" id="pullRefresh">
        <div class="mobile-pull-refresh-text">
            <i class="fas fa-sync-alt"></i> Tarik untuk memperbarui
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div>
                    <h1>LINK SITUSTOTO</h1>
                    <p>Dashboard dengan fitur minimize dan optimasi untuk mengelola link dengan lebih efisien</p>
                </div>
            </div>
        </div>

        <!-- Mobile Stats Card -->
        <div class="mobile-stats-card">
            <div class="mobile-stats-title">Statistik Link</div>
            <div class="mobile-stats-grid">
                <div class="mobile-stat-item">
                    <div class="mobile-stat-value" id="mobileTotalGroups">0</div>
                    <div class="mobile-stat-label">Kelompok</div>
                </div>
                <div class="mobile-stat-item">
                    <div class="mobile-stat-value" id="mobileTotalLinks">0</div>
                    <div class="mobile-stat-label">Total Link</div>
                </div>
                <div class="mobile-stat-item">
                    <div class="mobile-stat-value" id="mobileValidLinks">0</div>
                    <div class="mobile-stat-label">Link Valid</div>
                </div>
                <div class="mobile-stat-item">
                    <div class="mobile-stat-value" id="mobileOpenedLinks">0</div>
                    <div class="mobile-stat-label">Terbuka</div>
                </div>
            </div>
        </div>

        <div id="status" class="status">
            <div class="status-content">
                <div class="status-icon" id="statusIcon">â³</div>
                <div id="statusText">Menyiapkan pembacaan data dari Google Sheets...</div>
                <span id="connectionMethod" class="connection-method">Direct</span>
            </div>
            <div id="ipInfo" class="ip-info">
                <i class="fas fa-globe"></i>
                <span>Mendeteksi IP dan lokasi...</span>
            </div>
        </div>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-icon">ðŸ“</div>
                <div class="stat-value" id="totalGroups">0</div>
                <div class="stat-label">Kelompok</div>
            </div>
            <div class="stat-box">
                <div class="stat-icon">ðŸ“ˆ</div>
                <div class="stat-value" id="totalLinks">0</div>
                <div class="stat-label">Total Link</div>
            </div>
            <div class="stat-box">
                <div class="stat-icon">âœ…</div>
                <div class="stat-value" id="validLinks">0</div>
                <div class="stat-label">Link Valid</div>
            </div>
            <div class="stat-box">
                <div class="stat-icon">ðŸš€</div>
                <div class="stat-value" id="openedLinks">0</div>
                <div class="stat-label">Terbuka</div>
            </div>
        </div>

        <!-- Search Feature -->
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="searchInput" class="search-input" placeholder="Cari Judul atau URL...">
            <button id="clearSearchBtn" class="clear-search-btn" title="Hapus Pencarian">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="controls">
            <div class="controls-left">
                <button class="control-btn" onclick="minimizeAll()">
                    <i class="fas fa-chevron-up"></i> Minimize Semua
                </button>
                <button class="control-btn" onclick="expandAll()">
                    <i class="fas fa-chevron-down"></i> Expand Semua
                </button>
                <button class="control-btn" onclick="refreshIPInfo()">
                    <i class="fas fa-map-marker-alt"></i> Refresh IP
                </button>
                <button class="control-btn" onclick="testIPServices()">
                    <i class="fas fa-bug"></i> Test IP
                </button>
            </div>
            <div class="controls-right">
                <button class="control-btn" onclick="minimizeCompletedGroups()">
                    <i class="fas fa-check-circle"></i> Minimize Selesai
                </button>
                <button class="control-btn" onclick="minimizeOpenedGroups()">
                    <i class="fas fa-eye-slash"></i> Minimize Terbuka
                </button>
                <button class="control-btn" onclick="resetOpenedStatus()">
                    <i class="fas fa-redo"></i> Reset Status
                </button>
            </div>
        </div>

        <div class="progress-container" id="progressContainer">
            <div class="progress-text" id="progressText">0% (0/0)</div>
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="buttons">
            <button class="btn" onclick="loadData()" id="loadBtn">
                <i class="fas fa-sync-alt"></i> Muat Ulang Data
            </button>
            <button class="btn btn-success" onclick="openAllLinks()" id="openAllBtn">
                <i class="fas fa-rocket"></i> Buka Semua Link Baru
            </button>
            <button class="btn btn-accent" onclick="openAllIncludingOpened()" id="openAllIncludingBtn">
                <i class="fas fa-play-circle"></i> Buka Semua Link
            </button>
            <button class="btn" onclick="copyAllLinks()" id="copyAllBtn">
                <i class="fas fa-copy"></i> Salin Semua Link
            </button>
            <div class="dropdown">
                <button class="btn" id="copyFormatBtn" onclick="toggleDropdown()">
                    <i class="fas fa-copy"></i> Salin dengan Format
                    <i class="fas fa-chevron-down" style="margin-left: 5px;"></i>
                </button>
                <div id="formatDropdown" class="dropdown-content">
                    <div class="dropdown-item selected" onclick="selectFormat('https')">
                        <i class="fas fa-lock"></i> Dengan HTTPS
                    </div>
                    <div class="dropdown-item" onclick="selectFormat('http')">
                        <i class="fas fa-unlock"></i> Tanpa HTTPS
                    </div>
                    <div class="dropdown-item" onclick="selectFormat('domain')">
                        <i class="fas fa-globe"></i> Hanya Domain
                    </div>
                </div>
            </div>
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Memuat dan mengelompokkan data</p>
            <div id="loadingMethod" class="loading-method" style="display: none;">
                Metode: <span id="currentMethod">Direct</span>
            </div>
        </div>

        <div id="groupsContainer" style="display: none;"></div>
        
        <!-- Mobile Groups Container -->
        <div id="mobileGroupsContainer" style="display: none;"></div>

        <div class="footer">
            <p>Dashboard LINK SITUSTOTO - Dengan optimasi dan multiple fallback methods</p>
        </div>
    </div>

    <!-- Hidden iframe untuk membuka link tanpa mengganggu dashboard -->
    <iframe id="hiddenIframe" style="display: none;"></iframe>

    <!-- Container untuk notifikasi -->
    <div id="notificationContainer"></div>

    <!-- Connection Status Indicator -->
    <div id="connectionStatus" class="connection-status">
        <i class="fas fa-wifi"></i>
        <span id="connectionStatusText">Checking...</span>
    </div>

    <!-- Modal for URL format selection -->
    <div id="formatModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-copy"></i>
                    Pilih Format URL
                </h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Pilih format URL yang ingin Anda salin:</p>
                <div class="format-options">
                    <div class="format-option selected" onclick="selectModalFormat('https')">
                        <input type="radio" name="format" value="https" checked>
                        <div class="format-label">
                            <div class="format-name">Dengan HTTPS</div>
                            <div class="format-description">Menyalin URL lengkap dengan protokol HTTPS</div>
                            <div class="format-example">https://example.com/path</div>
                        </div>
                    </div>
                    <div class="format-option" onclick="selectModalFormat('http')">
                        <input type="radio" name="format" value="http">
                        <div class="format-label">
                            <div class="format-name">Tanpa HTTPS</div>
                            <div class="format-description">Menyalin URL dengan protokol HTTP</div>
                            <div class="format-example">http://example.com/path</div>
                        </div>
                    </div>
                    <div class="format-option" onclick="selectModalFormat('domain')">
                        <input type="radio" name="format" value="domain">
                        <div class="format-label">
                            <div class="format-name">Hanya Domain</div>
                            <div class="format-description">Menyalin hanya domain tanpa protokol</div>
                            <div class="format-example">example.com/path</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal()">Batal</button>
                <button class="btn" onclick="copyWithSelectedFormat()">Salin</button>
            </div>
        </div>
    </div>
    
    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
        <div class="mobile-nav-items">
            <a href="#" class="mobile-nav-item active" onclick="setActiveNav(this, 'dashboard')">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="mobile-nav-item" onclick="setActiveNav(this, 'links')">
                <i class="fas fa-link"></i>
                <span>Link</span>
            </a>
            <a href="#" class="mobile-nav-item" onclick="setActiveNav(this, 'settings')">
                <i class="fas fa-cog"></i>
                <span>Pengaturan</span>
            </a>
            <a href="#" class="mobile-nav-item" onclick="setActiveNav(this, 'about')">
                <i class="fas fa-info-circle"></i>
                <span>Tentang</span>
            </a>
        </div>
    </nav>
    
    <!-- Mobile Floating Action Button -->
    <button class="mobile-fab" onclick="showMobileActions()">
        <i class="fas fa-plus"></i>
    </button>

    <script>
        const SHEET_ID = '1feBQosvIFfg3jun_IYMdJ01Nai2TtZjD';
        const SHEET_NAME = 'CEKLINK';

        let groups = [];
        let isProcessing = false;
        let openAllTimeout = null;
        let firstLoad = true;
        let userIP = '';
        let userLocation = '';
        let lastDataLoadTime = null;
        let dataCache = null;
        let cacheExpiryTime = 5 * 60 * 1000; // Cache expires after 5 minutes
        let retryCount = 0;
        let maxRetries = 3;
        let networkRetryDelay = 1000; // Start with 1 second delay
        let currentConnectionMethod = 'Direct';
        let isOnline = navigator.onLine;
        let selectedFormat = 'https'; // Default format
        let isMobile = window.innerWidth <= 768;
        let touchStartY = 0;
        let touchEndY = 0;
        let isPulling = false;

        // Connection Methods (tanpa VPN detection)
        const connectionMethods = {
            direct: {
                name: 'Direct',
                priority: 1,
                methods: [
                    { name: 'Direct CSV', url: `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}` },
                    { name: 'Direct JSON', url: `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}` }
                ]
            },
            cors: {
                name: 'CORS Proxy',
                priority: 2,
                methods: [
                    { name: 'CORS.io', proxy: 'https://corsproxy.io/?' },
                    { name: 'AllOrigins', proxy: 'https://api.allorigins.win/raw?url=' },
                    { name: 'CORS Bypass', proxy: 'https://cors-anywhere.herokuapp.com/' },
                    { name: 'CORS Proxy', proxy: 'https://proxy.cors.sh/' },
                    { name: 'ThingProxy', proxy: 'https://thingproxy.freeboard.io/fetch/' }
                ]
            },
            alternative: {
                name: 'Alternative',
                priority: 3,
                methods: [
                    { name: 'Google Sheets API', url: `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(SHEET_NAME)}?key=AIzaSyB4q7h2XrL1d8sYrJ8X9z7wK6v5F4t3E2a1` },
                    { name: 'Public CSV', url: `https://r.jina.ai/http://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&sheet=${encodeURIComponent(SHEET_NAME)}` },
                    { name: 'Jina AI', url: `https://r.jina.ai/http://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}` },
                    { name: 'Rss2Json', url: `https://r.jina.ai/http://docs.google.com/spreadsheets/d/${SHEET_ID}/pub?output=csv&sheet=${encodeURIComponent(SHEET_NAME)}` }
                ]
            },
            fallback: {
                name: 'Fallback',
                priority: 4,
                methods: [
                    { name: 'Textise', url: `https://r.jina.ai/http://textise.net/showtext.aspx?strURL=http://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&sheet=${encodeURIComponent(SHEET_NAME)}` },
                    { name: 'Rentry', url: `https://r.jina.ai/http://r.jina.ai/http://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&sheet=${encodeURIComponent(SHEET_NAME)}` }
                ]
            }
        };

        // ================= SEARCH FEATURE LOGIC =================
        const searchInput = document.getElementById('searchInput');
        const clearSearchBtn = document.getElementById('clearSearchBtn');

        function setupSearch() {
            if (!searchInput) return;

            // Input event for real-time filtering
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.trim();
                
                // Toggle Clear Button
                if (query.length > 0) {
                    clearSearchBtn.style.display = 'flex';
                } else {
                    clearSearchBtn.style.display = 'none';
                }

                filterGroups(query);
            });

            // Clear button click event
            clearSearchBtn.addEventListener('click', clearSearch);

            // Prevent form submission on Enter key (if input is inside a form)
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                }
            });
        }

        function filterGroups(query) {
            if (!query) {
                // If query is empty, reset visibility to default
                resetFilters();
                return;
            }

            const lowerQuery = query.toLowerCase();
            let matchCount = 0;

            // Filter Desktop Groups
            const desktopGroups = document.querySelectorAll('.group-container');
            desktopGroups.forEach(groupElement => {
                const groupIndex = parseInt(groupElement.dataset.groupIndex);
                const groupData = groups[groupIndex];

                if (!groupData) return;

                const titleMatch = groupData.title.toLowerCase().includes(lowerQuery);
                let linkMatch = false;

                // Check links
                const links = groupElement.querySelectorAll('.links-table tbody tr');
                links.forEach((row, index) => {
                    const linkData = groupData.links[index];
                    if (linkData) {
                        const urlText = linkData.url.toLowerCase();
                        const isMatch = urlText.includes(lowerQuery);
                        
                        if (isMatch) linkMatch = true;

                        // Highlight text in cell (Visual feedback)
                        const urlCell = row.querySelector('.url-cell');
                        if (urlCell) {
                            const originalText = urlCell.textContent; // This is truncated text
                            const fullUrl = linkData.url;
                            
                            // We can't easily highlight inside the truncated text perfectly without complex logic,
                            // but we can add a class to the row
                            if (isMatch) {
                                row.style.background = 'rgba(255, 209, 102, 0.1)';
                            } else {
                                row.style.background = '';
                            }
                        }
                    }
                });

                if (titleMatch || linkMatch) {
                    groupElement.classList.remove('filtered-hidden');
                    groupElement.classList.add('force-expanded'); // Auto expand to see links
                    groupElement.classList.remove('minimized');
                    
                    // Update the minimize button icon
                    const icon = groupElement.querySelector('.minimize-btn i');
                    if (icon) icon.className = 'fas fa-chevron-up';
                    
                    matchCount++;
                } else {
                    groupElement.classList.add('filtered-hidden');
                    groupElement.classList.remove('force-expanded');
                }
            });

            // Filter Mobile Groups
            const mobileGroups = document.querySelectorAll('.mobile-group-card');
            mobileGroups.forEach(groupElement => {
                const groupIndex = parseInt(groupElement.dataset.groupIndex);
                const groupData = groups[groupIndex];

                if (!groupData) return;

                const titleMatch = groupData.title.toLowerCase().includes(lowerQuery);
                let linkMatch = false;

                // Check links in mobile view
                const linkItems = groupElement.querySelectorAll('.mobile-link-item');
                linkItems.forEach((item, index) => {
                    const linkData = groupData.links[index];
                    if (linkData) {
                        const urlText = linkData.url.toLowerCase();
                        const isMatch = urlText.includes(lowerQuery);

                        if (isMatch) linkMatch = true;

                        // Highlight mobile link
                        const urlSpan = item.querySelector('.mobile-link-url');
                        if (urlSpan) {
                            if (isMatch) {
                                urlSpan.classList.add('highlight');
                            } else {
                                urlSpan.classList.remove('highlight');
                            }
                        }
                    }
                });

                if (titleMatch || linkMatch) {
                    groupElement.style.display = 'block';
                    matchCount++;
                } else {
                    groupElement.style.display = 'none';
                }
            });

            if (matchCount === 0) {
                updateStatus(`Tidak ditemukan hasil untuk "${query}"`, 'error');
            } else {
                updateStatus(`Ditemukan ${matchCount} kelompok cocok dengan "${query}"`, 'success');
            }
        }

        function clearSearch() {
            if (searchInput) {
                searchInput.value = '';
                clearSearchBtn.style.display = 'none';
            }
            resetFilters();
            searchInput.focus();
        }

        function resetFilters() {
            // Remove all filtering effects
            const desktopGroups = document.querySelectorAll('.group-container');
            desktopGroups.forEach(group => {
                group.classList.remove('filtered-hidden');
                group.classList.remove('force-expanded');
                
                // Reset row highlights
                const rows = group.querySelectorAll('.links-table tbody tr');
                rows.forEach(row => row.style.background = '');

                // If it was minimized before, re-minimize it (unless it was expanded manually)
                // For simplicity, let's keep them expanded after search or reset to default minimized if firstLoad is false
                if (!firstLoad && group.classList.contains('minimized')) {
                   // Re-apply minimized state logic if needed, but for now let's just clear the force-expand
                }
            });

            const mobileGroups = document.querySelectorAll('.mobile-group-card');
            mobileGroups.forEach(group => {
                group.style.display = '';
                const links = group.querySelectorAll('.mobile-link-url');
                links.forEach(link => link.classList.remove('highlight'));
            });
            
            // Re-render groups to restore proper minimized state if needed, 
            // but just removing CSS classes is faster and keeps scroll position.
            updateStatus('Pencarian direset', 'info');
        }

        // ================= END SEARCH FEATURE =================

        // Fungsi untuk menampilkan notifikasi
        function showNotification(message, type = 'info', duration = 5000) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.getElementById('notificationContainer').appendChild(notification);
            
            // Tampilkan notifikasi
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Sembunyikan notifikasi setelah durasi tertentu
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, duration);
        }

        // Update connection status indicator
        function updateConnectionStatus(status, text) {
            const statusElement = document.getElementById('connectionStatus');
            const textElement = document.getElementById('connectionStatusText');
            
            statusElement.className = `connection-status ${status}`;
            textElement.textContent = text;
        }

        // Update status display
        function updateStatus(message, type = 'info', method = null) {
            const status = document.getElementById('status');
            const icon = document.getElementById('statusIcon');
            const text = document.getElementById('statusText');
            const methodElement = document.getElementById('connectionMethod');

            text.textContent = message;

            if (method) {
                methodElement.textContent = method;
                methodElement.className = `connection-method ${method.toLowerCase().replace(' ', '-')}`;
                currentConnectionMethod = method;
            }

            if (type === 'success') {
                status.className = 'status success';
                icon.textContent = 'âœ…';
            } else if (type === 'error') {
                status.className = 'status error';
                icon.textContent = 'âŒ';
            } else {
                status.className = 'status';
                icon.textContent = 'â³';
            }

            // Animate status update
            status.style.animation = 'none';
            setTimeout(() => {
                status.style.animation = 'fadeIn 0.5s ease-out';
            }, 10);
        }

        // Update IP info display
        function updateIPInfo(ip, location) {
            const ipInfo = document.getElementById('ipInfo');
            if (ip && location) {
                ipInfo.innerHTML = `<i class="fas fa-globe"></i> IP: ${ip} | Lokasi: ${location}`;
            } else if (ip) {
                ipInfo.innerHTML = `<i class="fas fa-globe"></i> IP: ${ip}`;
            }
        }

        // Get IP address and location dengan retry mechanism
        async function getIPInfo() {
            try {
                // Try multiple IP services with better location detection
                const ipServices = [
                    { 
                        url: 'https://ipapi.co/json/', 
                        name: 'IPAPI',
                        parseLocation: (data) => {
                            if (data.city && data.region && data.country_name) {
                                return `${data.city}, ${data.region}, ${data.country_name}`;
                            } else if (data.city && data.country_name) {
                                return `${data.city}, ${data.country_name}`;
                            } else if (data.country_name) {
                                return data.country_name;
                            }
                            return null;
                        }
                    },
                    { 
                        url: 'https://ipinfo.io/json', 
                        name: 'IPInfo',
                        parseLocation: (data) => {
                            if (data.city && data.region && data.country) {
                                return `${data.city}, ${data.region}, ${data.country}`;
                            } else if (data.city && data.country) {
                                return `${data.city}, ${data.country}`;
                            } else if (data.country) {
                                return data.country;
                            }
                            return null;
                        }
                    },
                    { 
                        url: 'https://api.ipgeolocation.io/ipgeo?apiKey=free', 
                        name: 'IPGeoLocation',
                        parseLocation: (data) => {
                            if (data.city && data.state_prov && data.country_name) {
                                return `${data.city}, ${data.state_prov}, ${data.country_name}`;
                            } else if (data.city && data.country_name) {
                                return `${data.city}, ${data.country_name}`;
                            } else if (data.country_name) {
                                return data.country_name;
                            }
                            return null;
                        }
                    },
                    { 
                        url: 'https://freeipapi.com/api/json/', 
                        name: 'FreeIPAPI',
                        parseLocation: (data) => {
                            if (data.cityName && data.regionName && data.countryName) {
                                return `${data.cityName}, ${data.regionName}, ${data.countryName}`;
                            } else if (data.cityName && data.countryName) {
                                return `${data.cityName}, ${data.countryName}`;
                            } else if (data.countryName) {
                                return data.countryName;
                            }
                            return null;
                        }
                    },
                    { 
                        url: 'https://api.ipify.org?format=json', 
                        name: 'IPify',
                        parseLocation: (data) => {
                            // IPify only returns IP, no location data
                            return null;
                        }
                    }
                ];

                let ipData = null;
                let serviceUsed = null;
                let detectedLocation = null;

                for (const service of ipServices) {
                    try {
                        console.log(`Trying IP service: ${service.name}`);
                        const response = await fetch(service.url, {
                            signal: AbortSignal.timeout(8000) // Increased timeout
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            console.log(`Response from ${service.name}:`, data);
                            
                            // Extract IP
                            const ip = data.ip || data.ip_address || data.query || 'Tidak terdeteksi';
                            
                            // Extract location using service-specific parser
                            const location = service.parseLocation ? service.parseLocation(data) : null;
                            
                            if (ip && ip !== 'Tidak terdeteksi') {
                                ipData = { ip, location };
                                serviceUsed = service.name;
                                detectedLocation = location;
                                
                                // If we got location data, break
                                if (location) {
                                    break;
                                }
                            }
                        }
                    } catch (error) {
                        console.warn(`IP service ${service.name} failed:`, error);
                        continue;
                    }
                }

                // Try to get location from a different service if first one didn't provide it
                if (ipData && !detectedLocation) {
                    console.log('First service didn\'t provide location, trying location-specific services...');
                    
                    const locationServices = [
                        'https://ipapi.co/json/',
                        'https://ipinfo.io/json',
                        'https://freeipapi.com/api/json/'
                    ];
                    
                    for (const serviceUrl of locationServices) {
                        try {
                            const response = await fetch(serviceUrl, {
                                signal: AbortSignal.timeout(5000)
                            });
                            
                            if (response.ok) {
                                const data = await response.json();
                                
                                // Try different location field combinations
                                detectedLocation = 
                                    (data.city && data.region && data.country_name) ? `${data.city}, ${data.region}, ${data.country_name}` :
                                    (data.city && data.region && data.country) ? `${data.city}, ${data.region}, ${data.country}` :
                                    (data.cityName && data.regionName && data.countryName) ? `${data.cityName}, ${data.regionName}, ${data.countryName}` :
                                    (data.city && data.country_name) ? `${data.city}, ${data.country_name}` :
                                    (data.city && data.country) ? `${data.city}, ${data.country}` :
                                    (data.cityName && data.countryName) ? `${data.cityName}, ${data.countryName}` :
                                    data.country_name || data.country || data.countryName || null;
                                
                                if (detectedLocation) {
                                    console.log(`Location detected from ${serviceUrl}:`, detectedLocation);
                                    break;
                                }
                            }
                        } catch (error) {
                            console.warn(`Location service failed:`, error);
                            continue;
                        }
                    }
                }

                if (ipData) {
                    userIP = ipData.ip;
                    userLocation = detectedLocation || 'Lokasi tidak terdeteksi';
                    
                    updateIPInfo(userIP, userLocation);
                    updateStatus(`IP berhasil dideteksi (${serviceUsed})`, 'success');
                    
                    // Log results for debugging
                    console.log('IP Detection Results:', {
                        ip: userIP,
                        location: userLocation,
                        service: serviceUsed
                    });
                    
                    return true;
                }
                
                throw new Error('All IP services failed');
            } catch (error) {
                console.error('Error getting IP info:', error);
                
                // Fallback to basic IP detection
                try {
                    console.log('Trying fallback IP detection...');
                    const response = await fetch('https://api.ipify.org?format=json', {
                        signal: AbortSignal.timeout(5000)
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        userIP = data.ip || 'Tidak terdeteksi';
                        userLocation = 'Lokasi tidak tersedia';
                        updateIPInfo(userIP, userLocation);
                        updateStatus('IP berhasil dideteksi (Fallback)', 'success');
                        return true;
                    }
                } catch (fallbackError) {
                    console.error('Fallback IP detection failed:', fallbackError);
                }
                
                updateIPInfo('Error', 'Gagal mendeteksi');
                updateStatus('Gagal mendeteksi IP', 'error');
                return false;
            }
        }

        // Let's also add a debug function to test IP services
        window.testIPServices = async function() {
            console.log('Testing IP services...');
            
            const services = [
                'https://ipapi.co/json/',
                'https://ipinfo.io/json',
                'https://freeipapi.com/api/json/',
                'https://api.ipgeolocation.io/ipgeo?apiKey=free',
                'https://api.ipify.org?format=json'
            ];
            
            for (const service of services) {
                try {
                    console.log(`Testing: ${service}`);
                    const response = await fetch(service, {
                        signal: AbortSignal.timeout(5000)
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log(`âœ… ${service}:`, data);
                    } else {
                        console.log(`âŒ ${service}: HTTP ${response.status}`);
                    }
                } catch (error) {
                    console.log(`âŒ ${service}:`, error.message);
                }
            }
        };

        // Add a manual refresh button for IP detection
        window.refreshIPInfo = function() {
            userIP = '';
            userLocation = '';
            updateIPInfo('Mendeteksi...', 'Mohon tunggu');
            updateStatus('Mendeteksi ulang IP dan lokasi...', 'info');
            getIPInfo();
        };

        // Update progress bar
        function updateProgress(current, total) {
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');

            const percentage = Math.round((current / total) * 100);
            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `${percentage}% (${current}/${total})`;

            if (current < total) {
                progressContainer.style.display = 'flex';
            } else {
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                }, 1000);
            }
        }

        // Format URL based on selected format
        function formatUrlByOption(url, format) {
            if (!url || typeof url !== 'string') return '';

            let cleanUrl = url.trim();
            
            // Remove any surrounding quotes
            cleanUrl = cleanUrl.replace(/^["']|["']$/g, '');

            // Remove existing protocol
            cleanUrl = cleanUrl.replace(/^https?:\/\//, '');

            // Add protocol based on format
            if (format === 'https') {
                cleanUrl = 'https://' + cleanUrl;
            } else if (format === 'http') {
                cleanUrl = 'http://' + cleanUrl;
            }
            // For 'domain' format, we don't add any protocol

            return cleanUrl;
        }

        // Format URL to ensure it has protocol
        function formatUrl(url) {
            if (!url || typeof url !== 'string') return '';

            let cleanUrl = url.trim();
            
            // Remove any surrounding quotes
            cleanUrl = cleanUrl.replace(/^["']|["']$/g, '');

            // Add https:// if no protocol
            if (!cleanUrl.startsWith('http://') && !cleanUrl.startsWith('https://')) {
                cleanUrl = 'https://' + cleanUrl;
            }

            return cleanUrl;
        }

        // Simple CSV parser
        function parseCSV(csv) {
            const lines = [];
            const rows = csv.split(/\r\n|\n/);
            
            for (let row of rows) {
                if (row.trim()) {
                    const cells = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < row.length; i++) {
                        const char = row[i];
                        const nextChar = row[i + 1];
                        
                        if (char === '"' && inQuotes && nextChar === '"') {
                            current += '"';
                            i++;
                        } else if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            cells.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    
                    cells.push(current.trim());
                    lines.push(cells);
                }
            }
            
            return lines;
        }

        // Group links by title
        function groupLinksByTitle(links) {
            const groupsMap = {};

            links.forEach((link, index) => {
                let title = link.title || 'TANPA JUDUL';
                
                // Clean up title (remove extra spaces, etc)
                title = title.trim().toUpperCase();

                if (!groupsMap[title]) {
                    groupsMap[title] = {
                        id: Object.keys(groupsMap).length,
                        title: title,
                        links: []
                    };
                }

                groupsMap[title].links.push({
                    ...link,
                    id: `${title}-${groupsMap[title].links.length}`
                });
            });

            return Object.values(groupsMap);
        }

        // Fungsi untuk menangani error dengan retry
        async function handleRetry(error, retryFunction, context = '') {
            console.error(`Error in ${context}:`, error);
            
            if (retryCount < maxRetries) {
                retryCount++;
                const delay = networkRetryDelay * Math.pow(2, retryCount - 1); // Exponential backoff
                
                updateStatus(`Gagal memuat data. Mencoba lagi dalam ${delay/1000} detik... (Percobaan ${retryCount}/${maxRetries})`, 'error');
                
                // Tampilkan notifikasi error
                showNotification(`Gagal memuat data. Mencoba lagi dalam ${delay/1000} detik...`, 'error', 3000);
                
                // Tambahkan tombol retry untuk pengalaman pengguna yang lebih baik
                if (retryCount === 1) {
                    addRetryButton(retryFunction);
                }
                
                await new Promise(resolve => setTimeout(resolve, delay));
                return await retryFunction();
            } else {
                updateStatus('Gagal memuat data setelah beberapa percobaan. Silakan coba lagi nanti.', 'error');
                showNotification('Gagal memuat data setelah beberapa percobaan. Silakan coba lagi nanti.', 'error', 10000);
                
                // Tampilkan tombol retry
                addRetryButton(retryFunction);
                
                // Reset retry count untuk percobaan berikutnya
                retryCount = 0;
                throw new Error(`Failed after ${maxRetries} retries: ${error.message}`);
            }
        }

        // Fungsi untuk menambahkan tombol retry
        function addRetryButton(retryFunction) {
            const loadingElement = document.getElementById('loading');
            if (!loadingElement.querySelector('.retry-btn')) {
                const retryButton = document.createElement('button');
                retryButton.className = 'btn retry-btn';
                retryButton.innerHTML = '<i class="fas fa-redo"></i> Coba Lagi';
                retryButton.onclick = () => {
                    retryCount = 0; // Reset retry count
                    retryFunction();
                };
                loadingElement.appendChild(retryButton);
            }
        }

        // Load data dengan multiple fallback methods
        async function loadData() {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('groupsContainer').style.display = 'none';
                document.getElementById('mobileGroupsContainer').style.display = 'none';
                updateStatus('Memuat dan mengelompokkan data dari Google Sheets...');

                // Check if we have cached data that's still valid
                const now = new Date().getTime();
                if (dataCache && lastDataLoadTime && (now - lastDataLoadTime < cacheExpiryTime)) {
                    console.log('Using cached data');
                    groups = dataCache;
                    updateStats();
                    if (isMobile) {
                        displayMobileGroups();
                    } else {
                        displayGroups();
                    }
                    document.getElementById('loading').style.display = 'none';
                    if (isMobile) {
                        document.getElementById('mobileGroupsContainer').style.display = 'block';
                    } else {
                        document.getElementById('groupsContainer').style.display = 'block';
                    }
                    updateStatus(`Berhasil memuat ${groups.length} kelompok dari cache`, 'success');
                    animateStats();
                    
                    if (firstLoad) {
                        setTimeout(() => {
                            minimizeAll();
                            firstLoad = false;
                        }, 100);
                    }
                    return;
                }

                // Try different methods in order
                const methods = [connectionMethods.direct, connectionMethods.cors, connectionMethods.alternative, connectionMethods.fallback];

                let dataLoaded = false;
                let methodUsed = null;

                for (const method of methods) {
                    try {
                        console.log(`Trying method: ${method.name}`);
                        updateStatus(`Mencoba metode ${method.name}...`, 'info', method.name);
                        
                        // Show current method in loading
                        const loadingMethod = document.getElementById('loadingMethod');
                        const currentMethodSpan = document.getElementById('currentMethod');
                        loadingMethod.style.display = 'block';
                        currentMethodSpan.textContent = method.name;

                        if (method.name === 'Direct') {
                            await loadWithDirectMethod();
                        } else if (method.name === 'CORS Proxy') {
                            await loadWithCORSMethod();
                        } else if (method.name === 'Alternative') {
                            await loadWithAlternativeMethod();
                        } else if (method.name === 'Fallback') {
                            await loadWithFallbackMethod();
                        }

                        dataLoaded = true;
                        methodUsed = method.name;
                        break;
                    } catch (error) {
                        console.error(`Method ${method.name} failed:`, error);
                        continue;
                    }
                }

                if (!dataLoaded) {
                    throw new Error('All methods failed');
                }

                // Cache data
                dataCache = groups;
                lastDataLoadTime = new Date().getTime();
                
                // Update statistics
                updateStats();
                
                // Display groups
                if (isMobile) {
                    displayMobileGroups();
                } else {
                    displayGroups();
                }

                // Show groups container
                document.getElementById('loading').style.display = 'none';
                if (isMobile) {
                    document.getElementById('mobileGroupsContainer').style.display = 'block';
                } else {
                    document.getElementById('groupsContainer').style.display = 'block';
                }

                updateStatus(`Berhasil memuat ${groups.length} kelompok dengan total ${groups.reduce((sum, g) => sum + g.links.length, 0)} link`, 'success', methodUsed);
                showNotification(`Berhasil memuat ${groups.length} kelompok (${methodUsed})`, 'success');
                
                // Animate stats update
                animateStats();

                // Minimize semua kelompok saat pertama kali load
                if (firstLoad) {
                    setTimeout(() => {
                        minimizeAll();
                        firstLoad = false;
                    }, 100);
                }

            } catch (error) {
                console.error('All methods failed:', error);
                
                // If we have cached data, use it even if expired
                if (dataCache) {
                    console.log('Using expired cached data as fallback');
                    groups = dataCache;
                    updateStats();
                    if (isMobile) {
                        displayMobileGroups();
                    } else {
                        displayGroups();
                    }
                    document.getElementById('loading').style.display = 'none';
                    if (isMobile) {
                        document.getElementById('mobileGroupsContainer').style.display = 'block';
                    } else {
                        document.getElementById('groupsContainer').style.display = 'block';
                    }
                    updateStatus(`Menggunakan data cache yang kadaluarsa. ${groups.length} kelompok.`, 'error');
                    showNotification('Menggunakan data cache yang kadaluarsa. Beberapa informasi mungkin tidak terkini.', 'error', 8000);
                    
                    if (firstLoad) {
                        setTimeout(() => {
                            minimizeAll();
                            firstLoad = false;
                        }, 100);
                    }
                    return;
                }
                
                // If no cached data, show error message
                document.getElementById('loading').style.display = 'none';
                
                const groupsContainer = document.getElementById('groupsContainer');
                const mobileGroupsContainer = document.getElementById('mobileGroupsContainer');
                
                const errorMessage = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Gagal Memuat Data</h3>
                        <p>Error: ${error.message}</p>
                        <p>Pastikan:</p>
                        <ul style="text-align: left; margin-top: 10px;">
                            <li>Google Sheet sudah di-publikasikan (File > Share > Publish to web)</li>
                            <li>Koneksi internet stabil</li>
                            <li>Sheet ID dan nama sheet benar</li>
                        </ul>
                        <button class="btn" onclick="loadData()" style="margin-top: 20px;">
                            <i class="fas fa-redo"></i> Coba Lagi
                        </button>
                    </div>
                `;
                
                if (isMobile) {
                    mobileGroupsContainer.innerHTML = errorMessage;
                    mobileGroupsContainer.style.display = 'block';
                } else {
                    groupsContainer.innerHTML = errorMessage;
                    groupsContainer.style.display = 'block';
                }
            }
        }

        // Direct method
        async function loadWithDirectMethod() {
            const sheetUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;
            
            const response = await fetch(sheetUrl, {
                headers: {
                    'Accept': 'text/csv',
                    'Cache-Control': 'no-cache'
                },
                signal: AbortSignal.timeout(10000)
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const csvData = await response.text();
            await processCSVData(csvData);
        }

        // CORS method
        async function loadWithCORSMethod() {
            const sheetUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;
            const proxies = [
                'https://corsproxy.io/?',
                'https://api.allorigins.win/raw?url=',
                'https://cors-anywhere.herokuapp.com/',
                'https://proxy.cors.sh/',
                'https://thingproxy.freeboard.io/fetch/'
            ];
            
            let csvData = null;
            let proxyUsed = null;
            
            for (const proxy of proxies) {
                try {
                    const response = await fetch(proxy + encodeURIComponent(sheetUrl), {
                        headers: {
                            'Accept': 'text/csv'
                        },
                        signal: AbortSignal.timeout(10000)
                    });
                    
                    if (response.ok) {
                        csvData = await response.text();
                        proxyUsed = proxy;
                        break;
                    }
                } catch (error) {
                    console.warn(`Proxy ${proxy} failed:`, error);
                    continue;
                }
            }
            
            if (!csvData) {
                throw new Error('All CORS proxies failed');
            }
            
            await processCSVData(csvData);
        }

        // Alternative method
        async function loadWithAlternativeMethod() {
            const methods = [
                { name: 'Jina AI', url: `https://r.jina.ai/http://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}` },
                { name: 'Public CSV', url: `https://r.jina.ai/http://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&sheet=${encodeURIComponent(SHEET_NAME)}` },
                { name: 'Rss2Json', url: `https://r.jina.ai/http://docs.google.com/spreadsheets/d/${SHEET_ID}/pub?output=csv&sheet=${encodeURIComponent(SHEET_NAME)}` }
            ];
            
            let csvData = null;
            let methodUsed = null;
            
            for (const method of methods) {
                try {
                    const response = await fetch(method.url, {
                        signal: AbortSignal.timeout(10000)
                    });
                    
                    if (response.ok) {
                        const text = await response.text();
                        
                        // Extract CSV from Jina AI response
                        if (method.name.includes('Jina')) {
                            const csvMatch = text.match(/```csv\n([\s\S]*?)\n```/);
                            if (csvMatch) {
                                csvData = csvMatch[1];
                            } else {
                                csvData = text;
                            }
                        } else {
                            csvData = text;
                        }
                        
                        methodUsed = method.name;
                        break;
                    }
                } catch (error) {
                    console.warn(`Alternative method ${method.name} failed:`, error);
                    continue;
                }
            }
            
            if (!csvData) {
                throw new Error('All alternative methods failed');
            }
            
            await processCSVData(csvData);
        }

        // Fallback method
        async function loadWithFallbackMethod() {
            const methods = [
                { name: 'Textise', url: `https://r.jina.ai/http://textise.net/showtext.aspx?strURL=http://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&sheet=${encodeURIComponent(SHEET_NAME)}` },
                { name: 'Rentry', url: `https://r.jina.ai/http://r.jina.ai/http://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&sheet=${encodeURIComponent(SHEET_NAME)}` }
            ];
            
            let csvData = null;
            let methodUsed = null;
            
            for (const method of methods) {
                try {
                    const response = await fetch(method.url, {
                        signal: AbortSignal.timeout(15000)
                    });
                    
                    if (response.ok) {
                        const text = await response.text();
                        
                        // Extract CSV from response
                        const csvMatch = text.match(/```csv\n([\s\S]*?)\n```/);
                        if (csvMatch) {
                            csvData = csvMatch[1];
                        } else {
                            csvData = text;
                        }
                        
                        methodUsed = method.name;
                        break;
                    }
                } catch (error) {
                    console.warn(`Fallback method ${method.name} failed:`, error);
                    continue;
                }
            }
            
            if (!csvData) {
                throw new Error('All fallback methods failed');
            }
            
            await processCSVData(csvData);
        }

        // Process CSV data
        async function processCSVData(csvData) {
            // Parse CSV data
            const rows = parseCSV(csvData);
            
            // Cari baris awal data (biasanya dimulai dari baris ke-7)
            let startRow = 0;
            for (let i = 0; i < rows.length; i++) {
                if (rows[i].some(cell => cell && (cell.includes('http') || cell.includes('CHECK')))) {
                    startRow = i;
                    break;
                }
            }
            
            // Jika tidak ditemukan, gunakan baris 6 sebagai default
            if (startRow === 0) startRow = 6;
            
            const dataRows = rows.slice(startRow);
            const allLinks = [];
            const seenUrls = new Set();

            dataRows.forEach((row, index) => {
                if (row.length >= 2) {
                    const urlRaw = row[0] || '';
                    const title = row[1] || `Link ${index + 1}`;

                    if (urlRaw.trim()) {
                        const url = formatUrl(urlRaw);
                        const urlKey = url.toLowerCase();
                        const isDuplicate = seenUrls.has(urlKey);
                        
                        if (!isDuplicate) {
                            seenUrls.add(urlKey);
                        }

                        allLinks.push({
                            id: index,
                            title: title,
                            url: url,
                            isValid: url.startsWith('http'),
                            isDuplicate: isDuplicate,
                            opened: false,
                            lastOpened: null
                        });
                    }
                }
            });

            // Group links by title
            groups = groupLinksByTitle(allLinks);
        }

        // Animate stats counter
        function animateStats() {
            const stats = ['totalGroups', 'totalLinks', 'validLinks', 'openedLinks'];
            const mobileStats = ['mobileTotalGroups', 'mobileTotalLinks', 'mobileValidLinks', 'mobileOpenedLinks'];
            
            stats.forEach((stat, index) => {
                const element = document.getElementById(stat);
                const mobileElement = document.getElementById(mobileStats[index]);
                const target = parseInt(element.textContent);
                let current = 0;
                const increment = target / 30;

                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }
                    element.textContent = Math.round(current);
                    if (mobileElement) {
                        mobileElement.textContent = Math.round(current);
                    }
                }, 30);
            });
        }

        // Calculate and update statistics
        function updateStats() {
            let totalLinks = 0;
            let validLinks = 0;
            let openedLinks = 0;

            groups.forEach(group => {
                totalLinks += group.links.length;
                validLinks += group.links.filter(l => l.isValid && !l.isDuplicate).length;
                openedLinks += group.links.filter(l => l.opened).length;
            });

            document.getElementById('totalGroups').textContent = groups.length;
            document.getElementById('totalLinks').textContent = totalLinks;
            document.getElementById('validLinks').textContent = validLinks;
            document.getElementById('openedLinks').textContent = openedLinks;
            
            // Update mobile stats if available
            const mobileTotalGroups = document.getElementById('mobileTotalGroups');
            const mobileTotalLinks = document.getElementById('mobileTotalLinks');
            const mobileValidLinks = document.getElementById('mobileValidLinks');
            const mobileOpenedLinks = document.getElementById('mobileOpenedLinks');
            
            if (mobileTotalGroups) mobileTotalGroups.textContent = groups.length;
            if (mobileTotalLinks) mobileTotalLinks.textContent = totalLinks;
            if (mobileValidLinks) mobileValidLinks.textContent = validLinks;
            if (mobileOpenedLinks) mobileOpenedLinks.textContent = openedLinks;
        }

        // Display groups dengan indikator selesai
        function displayGroups() {
            const groupsContainer = document.getElementById('groupsContainer');
            groupsContainer.innerHTML = '';

            if (groups.length === 0) {
                groupsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <h3>Tidak ada kelompok data ditemukan</h3>
                        <p>Data dari Google Sheets kosong atau tidak dapat diakses</p>
                    </div>
                `;
                return;
            }

            let completedGroupsCount = 0;

            groups.forEach((group, groupIndex) => {
                // Calculate group statistics
                const totalLinks = group.links.length;
                const validLinks = group.links.filter(l => l.isValid && !l.isDuplicate).length;
                const openedLinks = group.links.filter(l => l.opened).length;
                const allOpened = validLinks > 0 && openedLinks === validLinks;

                if (allOpened) {
                    completedGroupsCount++;
                }

                const groupElement = document.createElement('div');
                groupElement.className = `group-container minimized ${allOpened ? 'completed' : ''}`;
                groupElement.style.animation = `fadeInUp 0.5s ease-out ${groupIndex * 0.1}s both`;
                groupElement.dataset.groupIndex = groupIndex;

                groupElement.innerHTML = `
                    <div class="group-header" onclick="toggleGroup(${groupIndex})">
                        <div class="group-title">
                            <i class="fas fa-folder${allOpened ? '-open' : ''}"></i>
                            ${group.title}
                            ${allOpened ? '<span style="margin-left: 10px; font-size: 0.75rem; color: var(--success);">âœ“ SELESAI</span>' : ''}
                        </div>
                        <div class="group-stats">
                            <span class="group-stat">
                                <i class="fas fa-link"></i> ${totalLinks}
                            </span>
                            <span class="group-stat">
                                <i class="fas fa-check-circle"></i> ${validLinks}
                            </span>
                            <span class="group-stat">
                                <i class="fas fa-rocket"></i> ${openedLinks}
                            </span>
                            ${allOpened ? '<span class="group-stat completed-badge"><i class="fas fa-check-double"></i> Selesai</span>' : ''}
                        </div>
                        <div class="group-actions">
                            <button class="btn btn-sm btn-success" onclick="openAllLinksInGroup(${groupIndex}); event.stopPropagation();">
                                <i class="fas fa-play-circle"></i> Buka Baru
                            </button>
                            <button class="btn btn-sm btn-accent" onclick="openAllIncludingOpenedInGroup(${groupIndex}); event.stopPropagation();">
                                <i class="fas fa-redo"></i> Buka Semua
                            </button>
                            <button class="btn btn-sm" onclick="copyGroupLinks(${groupIndex}); event.stopPropagation();">
                                <i class="fas fa-copy"></i> Salin
                            </button>
                            <button class="minimize-btn" onclick="toggleGroup(${groupIndex}); event.stopPropagation();">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                    </div>
                    <div class="group-content">
                        <table class="links-table">
                            <thead>
                                <tr>
                                    <th>URL</th>
                                    <th width="120">Status</th>
                                    <th width="200">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${group.links.map((link, linkIndex) => `
                                    <tr>
                                        <td class="url-cell">
                                            <a href="${link.url}" target="_blank" title="${link.url}" onclick="openSingleLink(${groupIndex}, ${linkIndex}); return false;">
                                                ${link.url.replace(/^https?:\/\//, '').substring(0, 50)}
                                                ${link.url.length > 50 ? '...' : ''}
                                            </a>
                                        </td>
                                        <td>
                                            ${getStatusBadge(link)}
                                        </td>
                                        <td class="action-cell">
                                            <button class="action-btn open-btn" onclick="openSingleLink(${groupIndex}, ${linkIndex})" 
                                                ${link.isDuplicate || !link.isValid ? 'disabled' : ''}>
                                                <i class="fas fa-external-link-alt"></i> ${link.opened ? 'Buka Lagi' : 'Buka'}
                                            </button>
                                            <button class="action-btn reopen-btn" onclick="reopenLink(${groupIndex}, ${linkIndex})" 
                                                ${link.isDuplicate || !link.isValid ? 'disabled' : ''}>
                                                <i class="fas fa-redo"></i> ${link.opened ? 'Buka Ulang' : 'Buka'}
                                            </button>
                                            <button class="action-btn copy-btn" onclick="copyLink(${groupIndex}, ${linkIndex}, this)" data-copied="false">
                                                <i class="fas fa-copy"></i> Salin
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;

                groupsContainer.appendChild(groupElement);
            });

            // Update status dengan informasi kelompok selesai
            if (completedGroupsCount > 0) {
                updateStatus(`${completedGroupsCount} dari ${groups.length} kelompok telah selesai dibuka`, 'success');
            }
        }
        
        // Display mobile groups
        function displayMobileGroups() {
            const mobileGroupsContainer = document.getElementById('mobileGroupsContainer');
            mobileGroupsContainer.innerHTML = '';

            if (groups.length === 0) {
                mobileGroupsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <h3>Tidak ada kelompok data ditemukan</h3>
                        <p>Data dari Google Sheets kosong atau tidak dapat diakses</p>
                    </div>
                `;
                return;
            }

            let completedGroupsCount = 0;

            groups.forEach((group, groupIndex) => {
                // Calculate group statistics
                const totalLinks = group.links.length;
                const validLinks = group.links.filter(l => l.isValid && !l.isDuplicate).length;
                const openedLinks = group.links.filter(l => l.opened).length;
                const allOpened = validLinks > 0 && openedLinks === validLinks;

                if (allOpened) {
                    completedGroupsCount++;
                }

                const groupElement = document.createElement('div');
                groupElement.className = `mobile-group-card ${allOpened ? 'completed' : ''}`;
                groupElement.style.animation = `fadeInUp 0.5s ease-out ${groupIndex * 0.1}s both`;
                groupElement.dataset.groupIndex = groupIndex;

                groupElement.innerHTML = `
                    <div class="mobile-group-header">
                        <div class="mobile-group-title">
                            <i class="fas fa-folder${allOpened ? '-open' : ''}"></i>
                            ${group.title}
                            ${allOpened ? '<span style="margin-left: 5px; font-size: 0.7rem; color: var(--success);">âœ“</span>' : ''}
                        </div>
                        <div class="mobile-group-stats">
                            <span class="mobile-group-stat">
                                <i class="fas fa-link"></i> ${totalLinks}
                            </span>
                            <span class="mobile-group-stat">
                                <i class="fas fa-check-circle"></i> ${validLinks}
                            </span>
                            <span class="mobile-group-stat">
                                <i class="fas fa-rocket"></i> ${openedLinks}
                            </span>
                        </div>
                    </div>
                    <div class="mobile-group-actions">
                        <button class="mobile-group-btn primary" onclick="toggleMobileGroup(${groupIndex})">
                            <i class="fas fa-chevron-down"></i> Lihat Link
                        </button>
                        <button class="mobile-group-btn success" onclick="openAllLinksInGroup(${groupIndex})">
                            <i class="fas fa-play-circle"></i> Buka Baru
                        </button>
                        <button class="mobile-group-btn accent" onclick="openAllIncludingOpenedInGroup(${groupIndex})">
                            <i class="fas fa-redo"></i> Buka Semua
                        </button>
                    </div>
                    <div class="mobile-link-list" id="mobile-links-${groupIndex}" style="display: none;">
                        ${group.links.map((link, linkIndex) => `
                            <div class="mobile-link-item">
                                <div class="mobile-link-url" title="${link.url}">
                                    ${link.url.replace(/^https?:\/\//, '').substring(0, 30)}
                                    ${link.url.length > 30 ? '...' : ''}
                                </div>
                                <div class="mobile-link-actions">
                                    <button class="mobile-link-btn" onclick="openSingleLink(${groupIndex}, ${linkIndex})" 
                                        ${link.isDuplicate || !link.isValid ? 'disabled' : ''}>
                                        <i class="fas fa-external-link-alt"></i>
                                    </button>
                                    <button class="mobile-link-btn copy" onclick="copyLink(${groupIndex}, ${linkIndex}, this)" data-copied="false">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;

                mobileGroupsContainer.appendChild(groupElement);
            });

            // Update status dengan informasi kelompok selesai
            if (completedGroupsCount > 0) {
                updateStatus(`${completedGroupsCount} dari ${groups.length} kelompok telah selesai dibuka`, 'success');
            }
        }

        // Get status badge HTML
        function getStatusBadge(link) {
            if (link.isDuplicate) {
                return `<span style="color: #94a3b8; font-weight: 500; display: flex; align-items: center; gap: 5px;">
                    <i class="fas fa-copy"></i> Duplikat
                </span>`;
            } else if (!link.isValid) {
                return `<span style="color: #ef476f; font-weight: 500; display: flex; align-items: center; gap: 5px;">
                    <i class="fas fa-times-circle"></i> Tidak Valid
                </span>`;
            } else if (link.opened) {
                const lastOpenedText = link.lastOpened ? 
                    `<br><small style="font-size: 0.7rem; opacity: 0.8;">Terakhir: ${new Date(link.lastOpened).toLocaleTimeString()}</small>` : '';
                return `<span style="color: #06d6a0; font-weight: 500; display: flex; align-items: center; gap: 5px;">
                    <i class="fas fa-check-circle"></i> Terbuka${lastOpenedText}
                </span>`;
            } else {
                return `<span style="color: #ffd166; font-weight: 500; display: flex; align-items: center; gap: 5px;">
                    <i class="fas fa-clock"></i> Menunggu
                </span>`;
            }
        }

        // Toggle minimize/expand group
        window.toggleGroup = function(groupIndex) {
            const groupElement = document.querySelector(`.group-container[data-group-index="${groupIndex}"]`);
            if (groupElement) {
                const isMinimized = groupElement.classList.contains('minimized');

                if (isMinimized) {
                    groupElement.classList.remove('minimized');
                    groupElement.classList.add('expanded');

                    const icon = groupElement.querySelector('.minimize-btn i');
                    if (icon) icon.className = 'fas fa-chevron-up';

                    updateStatus(`Kelompok "${groups[groupIndex].title}" diexpand`, 'success');
                } else {
                    groupElement.classList.add('minimized');
                    groupElement.classList.remove('expanded');

                    const icon = groupElement.querySelector('.minimize-btn i');
                    if (icon) icon.className = 'fas fa-chevron-down';

                    updateStatus(`Kelompok "${groups[groupIndex].title}" diminimized`, 'success');
                }
            }
        };
        
        // Toggle mobile group
        window.toggleMobileGroup = function(groupIndex) {
            const linkList = document.getElementById(`mobile-links-${groupIndex}`);
            if (linkList) {
                const isHidden = linkList.style.display === 'none';
                
                if (isHidden) {
                    linkList.style.display = 'block';
                    updateStatus(`Link untuk "${groups[groupIndex].title}" ditampilkan`, 'success');
                } else {
                    linkList.style.display = 'none';
                    updateStatus(`Link untuk "${groups[groupIndex].title}" disembunyikan`, 'success');
                }
            }
        };

        // Minimize all groups
        function minimizeAll() {
            const groupElements = document.querySelectorAll('.group-container');
            groupElements.forEach(element => {
                element.classList.add('minimized');
                element.classList.remove('expanded');
                const icon = element.querySelector('.minimize-btn i');
                if (icon) icon.className = 'fas fa-chevron-down';
            });
            updateStatus(`Semua ${groupElements.length} kelompok diminimized`, 'success');
        }

        // Expand all groups
        function expandAll() {
            const groupElements = document.querySelectorAll('.group-container');
            groupElements.forEach(element => {
                element.classList.remove('minimized');
                element.classList.add('expanded');
                const icon = element.querySelector('.minimize-btn i');
                if (icon) icon.className = 'fas fa-chevron-up';
            });
            updateStatus(`Semua ${groupElements.length} kelompok diexpand`, 'success');
        }

        // Minimize completed groups
        function minimizeCompletedGroups() {
            let minimizedCount = 0;
            groups.forEach((group, groupIndex) => {
                const validLinks = group.links.filter(l => l.isValid && !l.isDuplicate).length;
                const openedLinks = group.links.filter(l => l.opened).length;

                if (validLinks > 0 && openedLinks === validLinks) {
                    const groupElement = document.querySelector(`.group-container[data-group-index="${groupIndex}"]`);
                    if (groupElement && !groupElement.classList.contains('minimized')) {
                        groupElement.classList.add('minimized');
                        groupElement.classList.remove('expanded');
                        const icon = groupElement.querySelector('.minimize-btn i');
                        if (icon) icon.className = 'fas fa-chevron-down';
                        minimizedCount++;
                    }
                }
            });
            updateStatus(`${minimizedCount} kelompok yang sudah selesai diminimized`, 'success');
        }

        // Minimize opened groups
        function minimizeOpenedGroups() {
            let minimizedCount = 0;
            groups.forEach((group, groupIndex) => {
                const validLinks = group.links.filter(l => l.isValid && !l.isDuplicate).length;
                const openedLinks = group.links.filter(l => l.opened).length;

                if (validLinks > 0 && openedLinks === validLinks) {
                    const groupElement = document.querySelector(`.group-container[data-group-index="${groupIndex}"]`);
                    if (groupElement && !groupElement.classList.contains('minimized')) {
                        groupElement.classList.add('minimized');
                        groupElement.classList.remove('expanded');
                        const icon = groupElement.querySelector('.minimize-btn i');
                        if (icon) icon.className = 'fas fa-chevron-down';
                        minimizedCount++;
                    }
                }
            });
            updateStatus(`${minimizedCount} kelompok yang sudah terbuka diminimized`, 'success');
        }

        // Reset semua status opened
        function resetOpenedStatus() {
            groups.forEach(group => {
                group.links.forEach(link => {
                    link.opened = false;
                    link.lastOpened = null;
                });
            });
            
            updateStats();
            if (isMobile) {
                displayMobileGroups();
            } else {
                displayGroups();
            }
            updateStatus('Semua status "Terbuka" telah direset', 'success');
            showNotification('Semua status "Terbuka" telah direset', 'success');
        }
        
        // Open single link (fungsi asli)
        window.openSingleLink = function(groupIndex, linkIndex) {
            const link = groups[groupIndex].links[linkIndex];

            if (link.isDuplicate || !link.isValid) return;

            try {
                // Gunakan iframe tersembunyi
                const hiddenIframe = document.getElementById('hiddenIframe');
                hiddenIframe.src = link.url;

                // Juga buka di tab baru tanpa fokus
                setTimeout(() => {
                    window.open(link.url, '_blank', 'noopener,noreferrer');
                }, 10);

                // Tandai sebagai dibuka jika belum
                if (!link.opened) {
                    link.opened = true;
                }
                link.lastOpened = new Date().toISOString();
                
                updateStats();
                if (isMobile) {
                    displayMobileGroups();
                } else {
                    displayGroups();
                }
                updateStatus(`Link dibuka: ${link.url.substring(0, 50)}...`, 'success');
            } catch (error) {
                updateStatus('Gagal membuka link', 'error');
                showNotification('Gagal membuka link', 'error');
            }
        };

        // Fungsi baru: Buka kembali link yang sudah dibuka
        window.reopenLink = function(groupIndex, linkIndex) {
            const link = groups[groupIndex].links[linkIndex];
            
            if (link.isDuplicate || !link.isValid) return;
            
            try {
                const hiddenIframe = document.getElementById('hiddenIframe');
                hiddenIframe.src = link.url;
                
                setTimeout(() => {
                    window.open(link.url, '_blank', 'noopener,noreferrer');
                }, 10);
                
                // Update waktu terakhir dibuka
                link.lastOpened = new Date().toISOString();
                
                updateStatus(`Link dibuka kembali: ${link.url.substring(0, 50)}...`, 'success');
                
                // Update display untuk menampilkan waktu terakhir dibuka
                if (isMobile) {
                    displayMobileGroups();
                } else {
                    displayGroups();
                }
            } catch (error) {
                updateStatus('Gagal membuka link', 'error');
                showNotification('Gagal membuka link', 'error');
            }
        };
        
        // Copy single link
        window.copyLink = function(groupIndex, linkIndex, buttonElement) {
            const link = groups[groupIndex].links[linkIndex];

            // Cek apakah tombol sudah dalam state "copied"
            if (buttonElement.getAttribute('data-copied') === 'true') {
                return;
            }

            navigator.clipboard.writeText(link.url)
                .then(() => {
                    // Ubah tampilan tombol
                    buttonElement.classList.add('copied');
                    
                    if (buttonElement.classList.contains('mobile-link-btn')) {
                        buttonElement.innerHTML = '<i class="fas fa-check"></i>';
                    } else {
                        buttonElement.innerHTML = '<i class="fas fa-check"></i> Tercopy!';
                    }
                    
                    buttonElement.setAttribute('data-copied', 'true');
                    buttonElement.disabled = true;

                    // Update status dengan informasi IP
                    if (userIP) {
                        updateStatus(`Link berhasil disalin ke clipboard (IP: ${userIP})`, 'success');
                    } else {
                        updateStatus('Link berhasil disalin ke clipboard', 'success');
                    }

                    // Kembalikan tombol ke keadaan semula setelah 2 detik
                    setTimeout(() => {
                        buttonElement.classList.remove('copied');
                        
                        if (buttonElement.classList.contains('mobile-link-btn')) {
                            buttonElement.innerHTML = '<i class="fas fa-copy"></i>';
                        } else {
                            buttonElement.innerHTML = '<i class="fas fa-copy"></i> Salin';
                        }
                        
                        buttonElement.setAttribute('data-copied', 'false');
                        buttonElement.disabled = false;
                    }, 2000);
                })
                .catch(() => {
                    updateStatus('Gagal menyalin link', 'error');
                    showNotification('Gagal menyalin link', 'error');
                });
        };

        // Open all links in a specific group (hanya yang belum dibuka)
        window.openAllLinksInGroup = async function(groupIndex) {
            if (isProcessing) return;

            const group = groups[groupIndex];
            const validLinks = group.links.filter(l => l.isValid && !l.isDuplicate && !l.opened);

            if (validLinks.length === 0) {
                updateStatus(`Tidak ada link baru yang bisa dibuka di kelompok "${group.title}"`, 'error');
                showNotification(`Tidak ada link baru yang bisa dibuka di kelompok "${group.title}"`, 'error');
                return;
            }

            isProcessing = true;
            
            let openBtn;
            if (isMobile) {
                openBtn = document.querySelector(`.mobile-group-card[data-group-index="${groupIndex}"] .mobile-group-btn.success`);
            } else {
                openBtn = document.querySelector(`.group-container[data-group-index="${groupIndex}"] .btn-success`);
            }
            
            const originalHTML = openBtn.innerHTML;

            openBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Membuka...';
            openBtn.disabled = true;

            updateStatus(`Membuka ${validLinks.length} link baru di kelompok "${group.title}"...`);
            updateProgress(0, validLinks.length);

            // Clear any existing timeout
            if (openAllTimeout) clearTimeout(openAllTimeout);

            // Open all links in the group
            for (let i = 0; i < validLinks.length; i++) {
                const link = validLinks[i];
                const linkIndex = group.links.findIndex(l => l.url === link.url);

                try {
                    // Gunakan iframe tersembunyi
                    const hiddenIframe = document.getElementById('hiddenIframe');
                    hiddenIframe.src = link.url;

                    // Juga buka di tab baru tanpa fokus
                    setTimeout(() => {
                        window.open(link.url, '_blank', 'noopener,noreferrer');
                    }, 10);

                    groups[groupIndex].links[linkIndex].opened = true;
                    groups[groupIndex].links[linkIndex].lastOpened = new Date().toISOString();
                    
                    updateProgress(i + 1, validLinks.length);
                    
                    await new Promise(resolve => {
                        openAllTimeout = setTimeout(resolve, 500);
                    });
                    
                } catch (error) {
                    console.error('Error opening link:', error);
                }
            }
            
            updateStats();
            if (isMobile) {
                displayMobileGroups();
            } else {
                displayGroups();
            }
            
            updateProgress(validLinks.length, validLinks.length);
            updateStatus(`Berhasil membuka ${validLinks.length} link baru di kelompok "${group.title}"`, 'success');
            showNotification(`Berhasil membuka ${validLinks.length} link baru di kelompok "${group.title}"`, 'success');
            
            setTimeout(() => {
                isProcessing = false;
                if (isMobile) {
                    openBtn.innerHTML = '<i class="fas fa-play-circle"></i> Buka Baru';
                } else {
                    openBtn.innerHTML = '<i class="fas fa-play-circle"></i> Buka Baru';
                }
                openBtn.disabled = false;
            }, 1000);
        };
        
        // Fungsi baru: Buka semua link dalam kelompok (termasuk yang sudah dibuka)
        window.openAllIncludingOpenedInGroup = async function(groupIndex) {
            if (isProcessing) return;
            
            const group = groups[groupIndex];
            const validLinks = group.links.filter(l => l.isValid && !l.isDuplicate);
            
            if (validLinks.length === 0) {
                updateStatus(`Tidak ada link yang bisa dibuka di kelompok "${group.title}"`, 'error');
                showNotification(`Tidak ada link yang bisa dibuka di kelompok "${group.title}"`, 'error');
                return;
            }
            
            isProcessing = true;
            
            let openBtn;
            if (isMobile) {
                openBtn = document.querySelector(`.mobile-group-card[data-group-index="${groupIndex}"] .mobile-group-btn.accent`);
            } else {
                openBtn = document.querySelector(`.group-container[data-group-index="${groupIndex}"] .btn-accent`);
            }
            
            const originalHTML = openBtn.innerHTML;
            
            openBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Membuka...';
            openBtn.disabled = true;
            
            updateStatus(`Membuka ${validLinks.length} link di kelompok "${group.title}" (termasuk yang sudah dibuka)...`);
            updateProgress(0, validLinks.length);
            
            if (openAllTimeout) clearTimeout(openAllTimeout);
            
            for (let i = 0; i < validLinks.length; i++) {
                const link = validLinks[i];
                const linkIndex = group.links.findIndex(l => l.url === link.url);
                
                try {
                    const hiddenIframe = document.getElementById('hiddenIframe');
                    hiddenIframe.src = link.url;
                    
                    setTimeout(() => {
                        window.open(link.url, '_blank', 'noopener,noreferrer');
                    }, 10);
                    
                    // Tandai sebagai dibuka jika belum
                    if (!groups[groupIndex].links[linkIndex].opened) {
                        groups[groupIndex].links[linkIndex].opened = true;
                    }
                    groups[groupIndex].links[linkIndex].lastOpened = new Date().toISOString();

                    // Update progress
                    updateProgress(i + 1, validLinks.length);

                    // Delay untuk menghindari pemblokiran popup
                    await new Promise(resolve => {
                        openAllTimeout = setTimeout(resolve, 500);
                    });

                } catch (error) {
                    console.error('Error opening link:', error);
                }
            }

            // Final update
            updateStats();
            if (isMobile) {
                displayMobileGroups();
            } else {
                displayGroups();
            }

            updateProgress(validLinks.length, validLinks.length);
            updateStatus(`Berhasil membuka ${validLinks.length} link di kelompok "${group.title}"`, 'success');
            showNotification(`Berhasil membuka ${validLinks.length} link di kelompok "${group.title}"`, 'success');

            // Re-enable button after a short delay
            setTimeout(() => {
                isProcessing = false;
                if (isMobile) {
                    openBtn.innerHTML = '<i class="fas fa-redo"></i> Buka Semua';
                } else {
                    openBtn.innerHTML = '<i class="fas fa-redo"></i> Buka Semua';
                }
                openBtn.disabled = false;
            }, 1000);
        };

        // Copy all links in a group
        window.copyGroupLinks = function(groupIndex) {
            const group = groups[groupIndex];
            const validLinks = group.links.filter(l => l.isValid && !l.isDuplicate);

            if (validLinks.length === 0) {
                updateStatus(`Tidak ada link yang bisa disalin di kelompok "${group.title}"`, 'error');
                showNotification(`Tidak ada link yang bisa disalin di kelompok "${group.title}"`, 'error');
                return;
            }

            const linksText = validLinks.map(l => l.url).join('\n');
            const buttonElement = event.target.closest('button');
            
            // Simpan state asli tombol
            const originalHTML = buttonElement.innerHTML;

            navigator.clipboard.writeText(linksText)
                .then(() => {
                    // Ubah tampilan tombol
                    buttonElement.classList.add('copied');
                    buttonElement.innerHTML = '<i class="fas fa-check"></i> Tercopy!';
                    buttonElement.disabled = true;

                    // Update status dengan informasi IP
                    if (userIP) {
                        updateStatus(`${validLinks.length} link dari "${group.title}" berhasil disalin (IP: ${userIP})`, 'success');
                    } else {
                        updateStatus(`${validLinks.length} link dari "${group.title}" berhasil disalin`, 'success');
                    }

                    // Kembalikan tombol ke keadaan semula setelah 2 detik
                    setTimeout(() => {
                        buttonElement.classList.remove('copied');
                        buttonElement.innerHTML = originalHTML;
                        buttonElement.disabled = false;
                    }, 2000);
                })
                .catch(() => {
                    updateStatus('Gagal menyalin link', 'error');
                    showNotification('Gagal menyalin link', 'error');
                });
        };

        // Open all links from all groups (hanya yang belum dibuka)
        async function openAllLinks() {
            if (isProcessing) return;

            let allValidLinks = [];
            groups.forEach(group => {
                const validLinks = group.links.filter(l => l.isValid && !l.isDuplicate && !l.opened);
                allValidLinks = allValidLinks.concat(validLinks.map(link => ({
                    ...link,
                    groupIndex: groups.indexOf(group),
                    groupTitle: group.title
                })));
            });

            if (allValidLinks.length === 0) {
                updateStatus('Tidak ada link baru yang bisa dibuka', 'error');
                showNotification('Tidak ada link baru yang bisa dibuka', 'error');
                return;
            }

            isProcessing = true;
            const openAllBtn = document.getElementById('openAllBtn');
            const openAllIncludingBtn = document.getElementById('openAllIncludingBtn');
            const loadBtn = document.getElementById('loadBtn');
            const copyAllBtn = document.getElementById('copyAllBtn');

            openAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Membuka...';
            openAllBtn.disabled = true;
            openAllIncludingBtn.disabled = true;
            loadBtn.disabled = true;
            copyAllBtn.disabled = true;

            updateStatus(`Membuka ${allValidLinks.length} link baru dari semua kelompok...`);
            updateProgress(0, allValidLinks.length);

            // Clear any existing timeout
            if (openAllTimeout) clearTimeout(openAllTimeout);

            // Open all links
            for (let i = 0; i < allValidLinks.length; i++) {
                const link = allValidLinks[i];
                const group = groups[link.groupIndex];
                const linkIndex = group.links.findIndex(l => l.url === link.url);

                try {
                    // Gunakan iframe tersembunyi
                    const hiddenIframe = document.getElementById('hiddenIframe');
                    hiddenIframe.src = link.url;

                    // Juga buka di tab baru tanpa fokus
                    setTimeout(() => {
                        window.open(link.url, '_blank', 'noopener,noreferrer');
                    }, 10);

                    groups[link.groupIndex].links[linkIndex].opened = true;
                    groups[link.groupIndex].links[linkIndex].lastOpened = new Date().toISOString();
                    
                    updateProgress(i + 1, allValidLinks.length);
                    
                    if (i % 5 === 0 || i === allValidLinks.length - 1) {
                        updateStats();
                    }
                    
                    await new Promise(resolve => {
                        openAllTimeout = setTimeout(resolve, 300);
                    });
                    
                } catch (error) {
                    console.error('Error opening link:', error);
                }
            }
            
            updateStats();
            if (isMobile) {
                displayMobileGroups();
            } else {
                displayGroups();
            }
            
            updateProgress(allValidLinks.length, allValidLinks.length);
            updateStatus(`Berhasil membuka ${allValidLinks.length} link baru dari semua kelompok`, 'success');
            showNotification(`Berhasil membuka ${allValidLinks.length} link baru dari semua kelompok`, 'success');
            
            setTimeout(() => {
                isProcessing = false;
                openAllBtn.innerHTML = '<i class="fas fa-rocket"></i> Buka Semua Link Baru';
                openAllBtn.disabled = false;
                openAllIncludingBtn.disabled = false;
                loadBtn.disabled = false;
                copyAllBtn.disabled = false;
            }, 1000);
        }
        
        // Fungsi baru: Buka semua link termasuk yang sudah dibuka
        async function openAllIncludingOpened() {
            if (isProcessing) return;
            
            let allValidLinks = [];
            groups.forEach(group => {
                const validLinks = group.links.filter(l => l.isValid && !l.isDuplicate);
                allValidLinks = allValidLinks.concat(validLinks.map(link => ({
                    ...link,
                    groupIndex: groups.indexOf(group),
                    groupTitle: group.title
                })));
            });
            
            if (allValidLinks.length === 0) {
                updateStatus('Tidak ada link yang bisa dibuka', 'error');
                showNotification('Tidak ada link yang bisa dibuka', 'error');
                return;
            }
            
            isProcessing = true;
            const openAllBtn = document.getElementById('openAllBtn');
            const openAllIncludingBtn = document.getElementById('openAllIncludingBtn');
            const loadBtn = document.getElementById('loadBtn');
            const copyAllBtn = document.getElementById('copyAllBtn');
            
            openAllIncludingBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Membuka...';
            openAllIncludingBtn.disabled = true;
            openAllBtn.disabled = true;
            loadBtn.disabled = true;
            copyAllBtn.disabled = true;
            
            updateStatus(`Membuka ${allValidLinks.length} link dari semua kelompok (termasuk yang sudah dibuka)...`);
            updateProgress(0, allValidLinks.length);
            
            if (openAllTimeout) clearTimeout(openAllTimeout);
            
            for (let i = 0; i < allValidLinks.length; i++) {
                const link = allValidLinks[i];
                const group = groups[link.groupIndex];
                const linkIndex = group.links.findIndex(l => l.url === link.url);
                
                try {
                    const hiddenIframe = document.getElementById('hiddenIframe');
                    hiddenIframe.src = link.url;
                    
                    setTimeout(() => {
                        window.open(link.url, '_blank', 'noopener,noreferrer');
                    }, 10);
                    
                    // Tandai sebagai dibuka jika belum
                    if (!groups[link.groupIndex].links[linkIndex].opened) {
                        groups[link.groupIndex].links[linkIndex].opened = true;
                    }
                    groups[link.groupIndex].links[linkIndex].lastOpened = new Date().toISOString();

                    // Update progress
                    updateProgress(i + 1, allValidLinks.length);

                    // Update stats every 5 links
                    if (i % 5 === 0 || i === allValidLinks.length - 1) {
                        updateStats();
                    }

                    // Delay untuk menghindari pemblokiran popup
                    await new Promise(resolve => {
                        openAllTimeout = setTimeout(resolve, 300);
                    });

                } catch (error) {
                    console.error('Error opening link:', error);
                }
            }

            // Final update
            updateStats();
            if (isMobile) {
                displayMobileGroups();
            } else {
                displayGroups();
            }

            updateProgress(allValidLinks.length, allValidLinks.length);
            updateStatus(`Berhasil membuka ${allValidLinks.length} link dari semua kelompok`, 'success');
            showNotification(`Berhasil membuka ${allValidLinks.length} link dari semua kelompok`, 'success');

            // Re-enable buttons after a short delay
            setTimeout(() => {
                isProcessing = false;
                openAllBtn.innerHTML = '<i class="fas fa-rocket"></i> Buka Semua Link Baru';
                openAllIncludingBtn.innerHTML = '<i class="fas fa-play-circle"></i> Buka Semua Link';
                openAllIncludingBtn.disabled = false;
                openAllBtn.disabled = false;
                loadBtn.disabled = false;
                copyAllBtn.disabled = false;
            }, 1000);
        }

        // Copy all links from all groups
        function copyAllLinks() {
            let allValidLinks = [];
            groups.forEach(group => {
                const validLinks = group.links.filter(l => l.isValid && !l.isDuplicate);
                allValidLinks = allValidLinks.concat(validLinks);
            });

            if (allValidLinks.length === 0) {
                updateStatus('Tidak ada link yang bisa disalin', 'error');
                showNotification('Tidak ada link yang bisa disalin', 'error');
                return;
            }

            const linksText = allValidLinks.map(l => l.url).join('\n');
            const buttonElement = document.getElementById('copyAllBtn');
            
            // Simpan state asli tombol
            const originalHTML = buttonElement.innerHTML;

            navigator.clipboard.writeText(linksText)
                .then(() => {
                    // Ubah tampilan tombol
                    buttonElement.classList.add('copied');
                    buttonElement.innerHTML = '<i class="fas fa-check"></i> Tercopy!';
                    buttonElement.disabled = true;

                    // Update status dengan informasi IP
                    if (userIP) {
                        updateStatus(`${allValidLinks.length} link dari semua kelompok berhasil disalin (IP: ${userIP})`, 'success');
                    } else {
                        updateStatus(`${allValidLinks.length} link dari semua kelompok berhasil disalin`, 'success');
                    }

                    // Kembalikan tombol ke keadaan semula setelah 2 detik
                    setTimeout(() => {
                        buttonElement.classList.remove('copied');
                        buttonElement.innerHTML = originalHTML;
                        buttonElement.disabled = false;
                    }, 2000);
                })
                .catch(() => {
                    updateStatus('Gagal menyalin link', 'error');
                    showNotification('Gagal menyalin link', 'error');
                });
        }
        
        // Toggle dropdown for format selection
        window.toggleDropdown = function() {
            const dropdown = document.getElementById('formatDropdown');
            dropdown.classList.toggle('show');
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function closeDropdown(e) {
                if (!e.target.closest('.dropdown')) {
                    dropdown.classList.remove('show');
                    document.removeEventListener('click', closeDropdown);
                }
            });
        };
        
        // Select format from dropdown
        window.selectFormat = function(format) {
            selectedFormat = format;
            
            // Update selected state in dropdown
            const dropdownItems = document.querySelectorAll('.dropdown-item');
            dropdownItems.forEach(item => {
                item.classList.remove('selected');
            });
            event.target.closest('.dropdown-item').classList.add('selected');
            
            // Close dropdown
            document.getElementById('formatDropdown').classList.remove('show');
            
            // Copy links with selected format
            copyAllLinksWithFormat(format);
        };
        
        // Copy all links with selected format
        function copyAllLinksWithFormat(format) {
            let allValidLinks = [];
            groups.forEach(group => {
                const validLinks = group.links.filter(l => l.isValid && !l.isDuplicate);
                allValidLinks = allValidLinks.concat(validLinks);
            });

            if (allValidLinks.length === 0) {
                updateStatus('Tidak ada link yang bisa disalin', 'error');
                showNotification('Tidak ada link yang bisa disalin', 'error');
                return;
            }

            const linksText = allValidLinks.map(l => formatUrlByOption(l.url, format)).join('\n');
            const buttonElement = document.getElementById('copyFormatBtn');
            
            // Simpan state asli tombol
            const originalHTML = buttonElement.innerHTML;

            navigator.clipboard.writeText(linksText)
                .then(() => {
                    // Ubah tampilan tombol
                    buttonElement.classList.add('copied');
                    buttonElement.innerHTML = '<i class="fas fa-check"></i> Tercopy!';
                    buttonElement.disabled = true;

                    // Update status dengan informasi IP dan format
                    const formatText = format === 'https' ? 'dengan HTTPS' : 
                                      format === 'http' ? 'dengan HTTP' : 'tanpa protokol';
                    
                    if (userIP) {
                        updateStatus(`${allValidLinks.length} link (${formatText}) dari semua kelompok berhasil disalin (IP: ${userIP})`, 'success');
                    } else {
                        updateStatus(`${allValidLinks.length} link (${formatText}) dari semua kelompok berhasil disalin`, 'success');
                    }

                    // Kembalikan tombol ke keadaan semula setelah 2 detik
                    setTimeout(() => {
                        buttonElement.classList.remove('copied');
                        buttonElement.innerHTML = originalHTML;
                        buttonElement.disabled = false;
                    }, 2000);
                })
                .catch(() => {
                    updateStatus('Gagal menyalin link', 'error');
                    showNotification('Gagal menyalin link', 'error');
                });
        }
        
        // Modal functions
        window.openModal = function() {
            document.getElementById('formatModal').classList.add('show');
        };
        
        window.closeModal = function() {
            document.getElementById('formatModal').classList.remove('show');
        };
        
        window.selectModalFormat = function(format) {
            selectedFormat = format;
            
            // Update selected state in modal
            const formatOptions = document.querySelectorAll('.format-option');
            formatOptions.forEach(option => {
                option.classList.remove('selected');
                const radio = option.querySelector('input[type="radio"]');
                if (radio && radio.value === format) {
                    option.classList.add('selected');
                    radio.checked = true;
                }
            });
        };
        
        window.copyWithSelectedFormat = function() {
            copyAllLinksWithFormat(selectedFormat);
            closeModal();
        };

        // Monitor connection status
        function monitorConnection() {
            window.addEventListener('online', () => {
                isOnline = true;
                updateConnectionStatus('online', 'Online');
                showNotification('Koneksi internet tersambung kembali', 'success');
                
                // Refresh data when coming back online
                if (!isProcessing) {
                    loadData();
                }
            });

            window.addEventListener('offline', () => {
                isOnline = false;
                updateConnectionStatus('offline', 'Offline');
                showNotification('Koneksi internet terputus', 'error');
            });
        }

        // Load data on page load
        window.addEventListener('DOMContentLoaded', async () => {
            // Check if mobile
            isMobile = window.innerWidth <= 768;
            
            // Setup search feature
            setupSearch();
            
            // Setup connection monitoring
            monitorConnection();
            
            // Load IP info
            getIPInfo();
            
            // Setup mobile pull to refresh
            if (isMobile) {
                setupPullToRefresh();
            }
            
            // Tambahkan timeout untuk loadData
            const loadTimeout = setTimeout(() => {
                if (document.getElementById('loading').style.display === 'block') {
                    updateStatus('Loading terlalu lama. Mencoba metode alternatif...', 'error');
                    showNotification('Loading terlalu lama. Mencoba metode alternatif...', 'error');
                    loadData();
                }
            }, 15000); // Diperpanjang menjadi 15 detik
            
            // Then load data from sheets
            loadData().finally(() => {
                clearTimeout(loadTimeout);
            });
        });

        // Clean up timeout on page unload
        window.addEventListener('beforeunload', () => {
            if (openAllTimeout) clearTimeout(openAllTimeout);
        });

        // Handle visibility change to pause/resume operations
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Page is hidden, pause any operations
                console.log('Page is hidden, pausing operations');
            } else {
                // Page is visible again, check if data needs refresh
                const now = new Date().getTime();
                if (lastDataLoadTime && (now - lastDataLoadTime > cacheExpiryTime)) {
                    console.log('Data might be expired but no notification will be shown.');
                    // Notifikasi peringatan telah dihapus sesuai permintaan.
                }
            }
        });
        
        // Handle window resize
        window.addEventListener('resize', () => {
            const newIsMobile = window.innerWidth <= 768;
            
            if (newIsMobile !== isMobile) {
                isMobile = newIsMobile;
                
                // Toggle between desktop and mobile views
                if (isMobile) {
                    document.getElementById('groupsContainer').style.display = 'none';
                    document.getElementById('mobileGroupsContainer').style.display = 'block';
                    displayMobileGroups();
                } else {
                    document.getElementById('mobileGroupsContainer').style.display = 'none';
                    document.getElementById('groupsContainer').style.display = 'block';
                    displayGroups();
                }
            }
        });
        
        // Mobile-specific functions
        window.toggleMobileMenu = function() {
            // Implement mobile menu toggle
            showNotification('Menu mobile akan segera tersedia', 'info');
        };
        
        window.setActiveNav = function(element, section) {
            // Remove active class from all nav items
            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to clicked item
            element.classList.add('active');
            
            // Handle section navigation
            switch(section) {
                case 'dashboard':
                    // Already on dashboard
                    break;
                case 'links':
                    // Scroll to links section
                    if (isMobile) {
                        document.getElementById('mobileGroupsContainer').scrollIntoView({ behavior: 'smooth' });
                    } else {
                        document.getElementById('groupsContainer').scrollIntoView({ behavior: 'smooth' });
                    }
                    break;
                case 'settings':
                    // Show settings
                    showNotification('Pengaturan akan segera tersedia', 'info');
                    break;
                case 'about':
                    // Show about
                    showNotification('Tentang akan segera tersedia', 'info');
                    break;
            }
        };
        
        window.showMobileActions = function() {
            // Create a simple action menu
            const actions = [
                { icon: 'fa-sync-alt', text: 'Muat Ulang Data', action: 'loadData()' },
                { icon: 'fa-rocket', text: 'Buka Semua Link Baru', action: 'openAllLinks()' },
                { icon: 'fa-play-circle', text: 'Buka Semua Link', action: 'openAllIncludingOpened()' },
                { icon: 'fa-copy', text: 'Salin Semua Link', action: 'copyAllLinks()' }
            ];
            
            let actionsHTML = '<div style="display: flex; flex-direction: column; gap: 10px;">';
            
            actions.forEach(action => {
                actionsHTML += `
                    <button class="btn" style="width: 100%; justify-content: flex-start;" onclick="${action.action}">
                        <i class="fas ${action.icon}"></i> ${action.text}
                    </button>
                `;
            });
            
            actionsHTML += '</div>';
            
            // Create a simple modal
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 300px;">
                    <div class="modal-header">
                        <h2 class="modal-title">
                            <i class="fas fa-bolt"></i>
                            Aksi Cepat
                        </h2>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div class="modal-body">
                        ${actionsHTML}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        };
        
        // Setup pull to refresh for mobile
        function setupPullToRefresh() {
            const pullRefresh = document.getElementById('pullRefresh');
            const container = document.querySelector('.container');
            
            let startY = 0;
            let currentY = 0;
            let pulling = false;
            
            container.addEventListener('touchstart', (e) => {
                if (window.scrollY === 0) {
                    startY = e.touches[0].pageY;
                    pulling = true;
                }
            });
            
            container.addEventListener('touchmove', (e) => {
                if (!pulling) return;
                
                currentY = e.touches[0].pageY;
                const diff = currentY - startY;
                
                if (diff > 0 && diff < 150) {
                    pullRefresh.style.transform = `translateY(${diff}px)`;
                    pullRefresh.classList.add('active');
                    
                    if (diff > 100) {
                        document.querySelector('.mobile-pull-refresh-text').innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> Lepaskan untuk memperbarui';
                    } else {
                        document.querySelector('.mobile-pull-refresh-text').innerHTML = '<i class="fas fa-sync-alt"></i> Tarik untuk memperbarui';
                    }
                }
            });
            
            container.addEventListener('touchend', () => {
                if (!pulling) return;
                
                pulling = false;
                const diff = currentY - startY;
                
                if (diff > 100) {
                    // Trigger refresh
                    pullRefresh.style.transform = 'translateY(60px)';
                    document.querySelector('.mobile-pull-refresh-text').innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> Memperbarui...';
                    
                    loadData().then(() => {
                        // Reset after refresh
                        setTimeout(() => {
                            pullRefresh.style.transform = 'translateY(0)';
                            pullRefresh.classList.remove('active');
                            document.querySelector('.mobile-pull-refresh-text').innerHTML = '<i class="fas fa-sync-alt"></i> Tarik untuk memperbarui';
                        }, 1000);
                    });
                } else {
                    // Reset without refresh
                    pullRefresh.style.transform = 'translateY(0)';
                    pullRefresh.classList.remove('active');
                }
                
                startY = 0;
                currentY = 0;
            });
        }

        // =======================================================
        // SCRIPT PENGAMANAN: ANTI VIEW SOURCE & INSPECT ELEMENT
        // =======================================================
        
        // Mencegah klik kanan
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });

        // Mencegah kombinasi tombol (Ctrl+U, Ctrl+Shift+I, Ctrl+Shift+J, F12)
        document.addEventListener('keydown', function(e) {
            // Cek Ctrl+U
            if (e.ctrlKey && e.key === 'u') {
                e.preventDefault();
                return false;
            }
            
            // Cek Ctrl+Shift+I (Inspect Element)
            if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                e.preventDefault();
                return false;
            }
            
            // Cek Ctrl+Shift+J (Console)
            if (e.ctrlKey && e.shiftKey && e.key === 'J') {
                e.preventDefault();
                return false;
            }
            
            // Cek Ctrl+Shift+C (Inspect Element via DOM)
            if (e.ctrlKey && e.shiftKey && e.key === 'C') {
                e.preventDefault();
                return false;
            }

            // Cek F12
            if (e.key === 'F12') {
                e.preventDefault();
                return false;
            }
        });

        // Mencegah drag image (opsional, untuk keamanan tambahan)
        document.addEventListener('dragstart', function(e) {
            if (e.target.tagName === 'IMG') {
                e.preventDefault();
                return false;
            }
        });

    </script>
</body>
</html>
