<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRANSFORMERS 3D - Parser Data Mutasi Bank</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff5500;
            --primary-dark: #cc4400;
            --secondary: #0088ff;
            --secondary-dark: #0066cc;
            --dark-bg: #0a0a16;
            --panel-bg: rgba(20, 20, 40, 0.9);
            --text: #e0e0ff;
            --text-muted: #aaaacc;
            --accent: #00ffaa;
            --danger: #ff3366;
            --success: #00cc88;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            background-color: var(--dark-bg);
            color: var(--text);
            font-family: 'Exo 2', sans-serif;
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 85, 0, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 136, 255, 0.05) 0%, transparent 20%),
                linear-gradient(to bottom, rgba(10, 10, 22, 0.95), rgba(15, 15, 35, 0.95));
            position: relative;
        }
        
        .transformers-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            overflow: hidden;
        }
        
        .transformer-part {
            position: absolute;
            opacity: 0.03;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 2px;
            transform-style: preserve-3d;
        }
        
        .part-1 {
            width: 120px;
            height: 30px;
            top: 10%;
            left: 5%;
            transform: rotateZ(45deg) rotateX(60deg);
            animation: float 25s infinite linear;
        }
        
        .part-2 {
            width: 80px;
            height: 80px;
            top: 60%;
            right: 10%;
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            animation: float 30s infinite linear reverse;
        }
        
        .part-3 {
            width: 100px;
            height: 20px;
            bottom: 20%;
            left: 15%;
            transform: rotateZ(-30deg) rotateY(60deg);
            animation: float 20s infinite linear;
        }
        
        @keyframes float {
            0% { transform: rotateZ(0deg) translateY(0px) rotateX(60deg); }
            100% { transform: rotateZ(360deg) translateY(-50px) rotateX(60deg); }
        }
        
        .container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 20px;
            perspective: 1000px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            transform-style: preserve-3d;
            animation: headerFloat 6s ease-in-out infinite;
        }
        
        @keyframes headerFloat {
            0%, 100% { transform: translateY(0px) rotateX(5deg); }
            50% { transform: translateY(-10px) rotateX(5deg); }
        }
        
        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.5rem;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(to right, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 30px rgba(255, 85, 0, 0.3);
            letter-spacing: 2px;
            position: relative;
            display: inline-block;
        }
        
        h1:after {
            content: '';
            position: absolute;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, transparent, var(--primary), var(--secondary), transparent);
            bottom: -10px;
            left: 0;
            border-radius: 5px;
            box-shadow: 0 0 15px var(--primary);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--text-muted);
            margin-top: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.8;
        }
        
        .panels-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .panel {
            background-color: var(--panel-bg);
            border-radius: 15px;
            padding: 30px;
            flex: 1;
            min-width: 300px;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 85, 0, 0.2);
            transform-style: preserve-3d;
            transition: transform 0.4s ease, box-shadow 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        .panel:hover {
            transform: translateY(-10px) rotateX(5deg);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.7),
                0 0 30px rgba(255, 85, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .panel:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            box-shadow: 0 0 15px var(--primary);
        }
        
        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--text);
            display: flex;
            align-items: center;
            position: relative;
        }
        
        .panel-title:before {
            content: '';
            display: inline-block;
            width: 12px;
            height: 12px;
            background-color: var(--primary);
            margin-right: 15px;
            border-radius: 50%;
            box-shadow: 0 0 10px var(--primary);
        }
        
        textarea {
            width: 100%;
            height: 200px;
            padding: 20px;
            background-color: rgba(10, 10, 25, 0.7);
            border: 1px solid rgba(255, 85, 0, 0.3);
            border-radius: 10px;
            color: var(--text);
            font-family: 'Courier New', monospace;
            font-size: 15px;
            resize: vertical;
            transition: all 0.3s ease;
            line-height: 1.5;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(255, 85, 0, 0.3);
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 25px;
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            letter-spacing: 1px;
            flex: 1;
            min-width: 180px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.7s ease;
        }
        
        .btn:hover:before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--primary-dark), var(--primary));
            color: white;
            box-shadow: 0 5px 15px rgba(255, 85, 0, 0.4);
        }
        
        .btn-primary:hover {
            background: linear-gradient(to right, var(--primary), #ff7733);
            box-shadow: 0 8px 25px rgba(255, 85, 0, 0.6);
            transform: translateY(-3px);
        }
        
        .btn-secondary {
            background: linear-gradient(to right, #333355, #444477);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(to right, #444477, #555599);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            transform: translateY(-3px);
        }
        
        .btn-success {
            background: linear-gradient(to right, var(--success), #00ee99);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 204, 136, 0.4);
        }
        
        .btn-success:hover {
            background: linear-gradient(to right, #00ee99, #22ffaa);
            box-shadow: 0 8px 25px rgba(0, 204, 136, 0.6);
            transform: translateY(-3px);
        }
        
        .filter-container {
            margin-top: 25px;
            padding: 20px;
            background-color: rgba(15, 15, 35, 0.7);
            border-radius: 10px;
            border-left: 5px solid var(--secondary);
        }
        
        .filter-label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--text);
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
        }
        
        .filter-select {
            padding: 12px 20px;
            background-color: rgba(10, 10, 25, 0.9);
            border: 1px solid var(--secondary);
            border-radius: 8px;
            color: var(--text);
            font-family: 'Exo 2', sans-serif;
            font-size: 1rem;
            width: 100%;
            max-width: 300px;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%230088ff'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 20px;
            cursor: pointer;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(255, 85, 0, 0.3);
        }
        
        .stats {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(15, 15, 35, 0.7);
            border-radius: 10px;
            border-left: 5px solid var(--accent);
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            color: var(--accent);
            text-shadow: 0 0 10px rgba(0, 255, 170, 0.5);
        }
        
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 20px 30px;
            border-radius: 10px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform: translateX(120%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            max-width: 350px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification-success {
            background: linear-gradient(to right, var(--success), #00ee99);
            color: white;
            border-left: 5px solid #00ffaa;
        }
        
        .notification-error {
            background: linear-gradient(to right, var(--danger), #ff5588);
            color: white;
            border-left: 5px solid #ff3366;
        }
        
        .transformer-logo {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            z-index: 10;
        }
        
        .logo-inner {
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
            animation: rotateLogo 20s infinite linear;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        @keyframes rotateLogo {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .logo-text {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 1.8rem;
            background: linear-gradient(to right, #0a0a16, #222244);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        @media (max-width: 768px) {
            .panels-container {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .btn {
                min-width: 100%;
            }
            
            .transformer-logo {
                position: relative;
                top: 0;
                right: 0;
                margin: 0 auto 20px;
            }
        }
        
        .processing {
            position: relative;
        }
        
        .processing:after {
            content: '';
            position: absolute;
            width: 25px;
            height: 25px;
            border: 3px solid transparent;
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            right: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, transparent, var(--accent), transparent);
            box-shadow: 0 0 10px var(--accent);
            z-index: 1;
            opacity: 0;
            animation: scan 3s linear infinite;
        }
        
        @keyframes scan {
            0% { top: 0; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        
        @keyframes transformSound {
            0% { transform: scale(1); }
            25% { transform: scale(0.95); }
            50% { transform: scale(1.05); }
            75% { transform: scale(0.98); }
            100% { transform: scale(1); }
        }
        
        .transform-click {
            animation: transformSound 0.3s ease;
        }
        
        .debug-info {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(255, 0, 0, 0.1);
            border-radius: 5px;
            border-left: 3px solid #ff3366;
            font-size: 12px;
            color: #ff9999;
            display: none;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="transformers-bg">
        <div class="transformer-part part-1"></div>
        <div class="transformer-part part-2"></div>
        <div class="transformer-part part-3"></div>
        <div class="scan-line"></div>
    </div>
    
    <div class="transformer-logo">
        <div class="logo-inner">
            <div class="logo-text">T3D</div>
        </div>
    </div>
    
    <div class="container">
        <div class="header">
            <h1>TRANSFORMERS 3D</h1>
            <h2>PARSER DATA MUTASI BANK</h2>
            <p class="subtitle">Tool canggih dengan teknologi transform untuk mengekstrak nama dan nominal dari data mutasi bank. Hasil dapat langsung disalin untuk analisis lebih lanjut.</p>
        </div>
        
        <div class="panels-container">
            <div class="panel">
                <div class="panel-title">
                    <span>üì• INPUT DATA MUTASI</span>
                </div>
                <textarea id="inputData" placeholder="Tempel data mutasi bank di sini... (Format: END, TRSF, nominal, nama, dll)">PEND
TRSF E-BANKING DB
2201/FTSCY/WS95271
20000000.00
ACHMAD FAUZAN ARIF
0000
20,000,000.00
DB
2,521,382.00
PEND
TRSF E-BANKING CR
2201/FTSCY/WS95031
100000.00
AGUS MULIAWAN, A.M
0000
100,000.00
CR
2,621,382.00
PEND
BI-FAST CR
TANGGAL :22/01 TRANSFER DR 008 SIBENG SISWANTO
0000
40,000,212.00
CR
42,621,594.00
PEND
TRSF E-BANKING CR
2201/FTSCY/WS95031
300000.00
MARHASURUNGAN SIHO
0000
300,000.00
CR
42,921,594.00
PEND
SETORAN VIA CDM
TANGGAL :22/01 22/01 WSID:Z9PP1 YUDI PURNO NUGROHO
0998
100,000.00
CR
43,021,594.00
PEND
TRSF E-BANKING CR
2201/FTSCY/WS95271
250701.00
HASRUN
0000
250,701.00
CR
43,272,295.00
PEND</textarea>
                
                <div class="filter-container">
                    <label class="filter-label">FILTER JENIS TRANSAKSI:</label>
                    <select id="filterType" class="filter-select">
                        <option value="all">SEMUA TRANSAKSI</option>
                        <option value="CR">KREDIT (CR) SAJA</option>
                        <option value="DB">DEBIT (DB) SAJA</option>
                    </select>
                </div>
                
                <div class="controls">
                    <button id="parseBtn" class="btn btn-primary">
                        <span>üîß PARSE DATA</span>
                    </button>
                    <button id="clearBtn" class="btn btn-secondary">
                        <span>üóëÔ∏è BERSIHKAN</span>
                    </button>
                    <button id="loadSampleBtn" class="btn btn-secondary">
                        <span>üìä DATA CONTOH</span>
                    </button>
                </div>
                
                <div class="debug-info" id="debugInfo"></div>
            </div>
            
            <div class="panel">
                <div class="panel-title">
                    <span>üì§ HASIL EKSTRAKSI</span>
                </div>
                
                <div class="controls">
                    <button id="copyBtn" class="btn btn-success">
                        <span>üìã SALIN HASIL</span>
                    </button>
                    <button id="testBtn" class="btn btn-secondary">
                        <span>üß™ TEST BI-FAST</span>
                    </button>
                </div>
                
                <textarea id="outputText" readonly placeholder="Hasil ekstraksi akan muncul di sini..."></textarea>
                
                <div class="stats" id="statsInfo">
                    STATUS: MENUNGGU INPUT DATA...
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <span id="notificationText">Berhasil disalin ke clipboard!</span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const inputData = document.getElementById('inputData');
            const outputText = document.getElementById('outputText');
            const parseBtn = document.getElementById('parseBtn');
            const clearBtn = document.getElementById('clearBtn');
            const loadSampleBtn = document.getElementById('loadSampleBtn');
            const copyBtn = document.getElementById('copyBtn');
            const testBtn = document.getElementById('testBtn');
            const filterType = document.getElementById('filterType');
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const statsInfo = document.getElementById('statsInfo');
            const debugInfo = document.getElementById('debugInfo');
            
            // PARSING FUNCTION - SIMPLE AND WORKING
            function parseData() {
                const data = inputData.value;
                const lines = data.split('\n');
                const results = [];
                
                // Clear debug info
                debugInfo.innerHTML = '';
                debugInfo.style.display = 'none';
                
                // Button effect
                parseBtn.classList.add('transform-click');
                setTimeout(() => parseBtn.classList.remove('transform-click'), 300);
                
                let i = 0;
                while (i < lines.length) {
                    const line = lines[i].trim();
                    
                    // Skip empty lines
                    if (!line) {
                        i++;
                        continue;
                    }
                    
                    // Check for transaction start
                    if (line.includes('TRSF E-BANKING') || line.includes('BI-FAST') || line.includes('SETORAN')) {
                        const transaction = processTransaction(lines, i);
                        if (transaction && transaction.name && transaction.nominal) {
                            // Apply filter
                            const filter = filterType.value;
                            if (filter === 'all' || filter === transaction.type) {
                                results.push(transaction);
                            }
                        }
                        // Skip ahead
                        i = Math.max(i + 1, transaction?.skipTo || i + 1);
                    } else {
                        i++;
                    }
                }
                
                // Format output
                let output = '';
                results.forEach(item => {
                    output += `${item.name}\t${item.nominal}\n`;
                });
                
                outputText.value = output;
                
                // Update stats
                updateStats(results);
                
                showNotification(`Data berhasil diparsing! Ditemukan ${results.length} transaksi.`, 'success');
            }
            
            // Process a transaction block
            function processTransaction(lines, startIndex) {
                const result = {
                    name: '',
                    nominal: '',
                    type: '',
                    skipTo: startIndex + 1
                };
                
                const line = lines[startIndex].trim();
                
                // Determine transaction type
                if (line.includes(' CR')) result.type = 'CR';
                else if (line.includes(' DB')) result.type = 'DB';
                else result.type = line.includes('BI-FAST') ? 'CR' : 'UNKNOWN';
                
                // Process based on transaction type
                if (line.includes('TRSF E-BANKING')) {
                    return processTRSF(lines, startIndex, result);
                } else if (line.includes('BI-FAST')) {
                    return processBIFast(lines, startIndex, result);
                } else if (line.includes('SETORAN')) {
                    return processSetoran(lines, startIndex, result);
                }
                
                return result;
            }
            
            // Process TRSF E-BANKING transaction
            function processTRSF(lines, startIndex, result) {
                // Pattern for TRSF:
                // TRSF E-BANKING CR/DB
                // [code/ref - skip]
                // [nominal without comma]
                // [name]
                // 0000/0998
                // [nominal with comma]
                // CR/DB
                
                for (let i = startIndex + 1; i < Math.min(startIndex + 10, lines.length); i++) {
                    const line = lines[i].trim();
                    
                    // Find nominal without comma (like 20000000.00)
                    if (line.match(/^\d+\.\d{2}$/)) {
                        const numValue = parseFloat(line);
                        if (numValue >= 100) {
                            // Next line should be name
                            if (i + 1 < lines.length) {
                                const nameLine = lines[i + 1].trim();
                                if (isValidName(nameLine)) {
                                    result.name = nameLine;
                                    result.nominal = formatNominal(line);
                                    result.skipTo = i + 2;
                                    return result;
                                }
                            }
                        }
                    }
                    
                    // Alternative: find name then 0000 then nominal
                    if (line === '0000' || line === '0998') {
                        // Look back for name
                        if (i - 1 >= startIndex) {
                            const nameLine = lines[i - 1].trim();
                            if (isValidName(nameLine)) {
                                result.name = nameLine;
                                // Look forward for nominal
                                if (i + 1 < lines.length) {
                                    const nominalLine = lines[i + 1].trim();
                                    if (nominalLine.match(/^\d+,\d{3}(,\d{3})*\.\d{2}$/)) {
                                        result.nominal = formatNominal(nominalLine);
                                        result.skipTo = i + 2;
                                        return result;
                                    }
                                }
                            }
                        }
                    }
                }
                
                return result;
            }
            
            // Process BI-FAST transaction
            function processBIFast(lines, startIndex, result) {
                // Pattern for BI-FAST:
                // BI-FAST CR
                // [date and name line]
                // 0000
                // [nominal with comma]
                // CR
                
                // Extract name from the date line (next line)
                if (startIndex + 1 < lines.length) {
                    const dateLine = lines[startIndex + 1].trim();
                    const name = extractNameFromLine(dateLine);
                    if (name) {
                        result.name = name;
                    }
                }
                
                // Find 0000 and nominal
                for (let i = startIndex; i < Math.min(startIndex + 10, lines.length); i++) {
                    const line = lines[i].trim();
                    
                    if (line === '0000' || line === '0998') {
                        if (i + 1 < lines.length) {
                            const nominalLine = lines[i + 1].trim();
                            if (nominalLine.match(/^\d+,\d{3}(,\d{3})*\.\d{2}$/)) {
                                result.nominal = formatNominal(nominalLine);
                                result.skipTo = i + 2;
                                return result;
                            }
                        }
                    }
                }
                
                return result;
            }
            
            // Process SETORAN transaction
            function processSetoran(lines, startIndex, result) {
                // Pattern for SETORAN:
                // SETORAN VIA ...
                // [date and name line]
                // 0998
                // [nominal with comma]
                // CR
                
                // Extract name from the date line (next line)
                if (startIndex + 1 < lines.length) {
                    const dateLine = lines[startIndex + 1].trim();
                    const name = extractNameFromLine(dateLine);
                    if (name) {
                        result.name = name;
                    }
                }
                
                // Find 0998/0000 and nominal
                for (let i = startIndex; i < Math.min(startIndex + 10, lines.length); i++) {
                    const line = lines[i].trim();
                    
                    if (line === '0998' || line === '0000') {
                        if (i + 1 < lines.length) {
                            const nominalLine = lines[i + 1].trim();
                            if (nominalLine.match(/^\d+,\d{3}(,\d{3})*\.\d{2}$/)) {
                                result.nominal = formatNominal(nominalLine);
                                result.skipTo = i + 2;
                                return result;
                            }
                        }
                    }
                }
                
                return result;
            }
            
            // Helper functions
            function extractNameFromLine(line) {
                // For BI-FAST: "TANGGAL :22/01 TRANSFER DR 008 SIBENG SISWANTO"
                if (line.includes('DR ')) {
                    const parts = line.split('DR ');
                    if (parts.length > 1) {
                        const afterDR = parts[1];
                        const nameParts = afterDR.split(' ');
                        if (nameParts.length > 1) {
                            // Remove first part (008) and join the rest
                            return nameParts.slice(1).join(' ').trim();
                        }
                    }
                }
                
                // For SETORAN: "TANGGAL :22/01 22/01 WSID:Z9PP1 YUDI PURNO NUGROHO"
                if (line.includes('WSID:')) {
                    const wsidIndex = line.indexOf('WSID:');
                    if (wsidIndex !== -1) {
                        const afterWSID = line.substring(wsidIndex);
                        const parts = afterWSID.split(' ');
                        if (parts.length > 1) {
                            // Get parts after WSID:XXXXX
                            return parts.slice(1).join(' ').trim();
                        }
                    }
                }
                
                // If line looks like a name, return it
                if (isValidName(line)) {
                    return line;
                }
                
                return '';
            }
            
            function formatNominal(nominal) {
                // Remove .00 and commas
                return nominal.replace(/\.00$/, '').replace(/,/g, '');
            }
            
            function isValidName(str) {
                if (!str || str.length < 2) return false;
                
                // Not just numbers
                if (/^\d+$/.test(str)) return false;
                
                // Invalid patterns
                const invalidPatterns = [
                    /^\d{4}\/\w+\/\w+$/,  // codes like 2201/FTSCY/WS95271
                    /^TANGGAL/,           // date
                    /^TRSF/,              // transaction type
                    /^BI-FAST/,           // BI-FAST
                    /^SETORAN/,           // SETORAN
                    /^PEND$/,             // PEND
                    /^END$/,              // END
                    /^\d+\.\d{2}$/,       // nominal without comma
                    /^\d+,\d{3}/,         // nominal with comma
                    /^\d{4}$/,            // 4 digits like 0000
                    /^[A-Z]{1,2}\d{5,}$/, // codes like WS95271
                ];
                
                for (const pattern of invalidPatterns) {
                    if (pattern.test(str)) {
                        return false;
                    }
                }
                
                // Must contain letters
                if (!/[A-Za-z]/.test(str)) return false;
                
                // Minimum 2 letters
                const letterCount = (str.match(/[A-Za-z]/g) || []).length;
                if (letterCount < 2) return false;
                
                // Allowed characters
                const allowedPattern = /^[A-Za-z0-9\s\.,]+$/;
                return allowedPattern.test(str);
            }
            
            function updateStats(results) {
                if (results.length > 0) {
                    const filterText = filterType.value === 'all' ? '' : ` (${filterType.value})`;
                    const totalAmount = results.reduce((sum, item) => {
                        const num = parseFloat(item.nominal.replace(/,/g, ''));
                        return sum + (isNaN(num) ? 0 : num);
                    }, 0);
                    
                    const crCount = results.filter(r => r.type === 'CR').length;
                    const dbCount = results.filter(r => r.type === 'DB').length;
                    
                    statsInfo.innerHTML = `
                        STATUS: <span style="color:#00ffaa">SUKSES</span><br>
                        TOTAL: <span style="color:#ff5500">${results.length} TRANSAKSI${filterText}</span><br>
                        CR: <span style="color:#00ffaa">${crCount}</span> | 
                        DB: <span style="color:#ff5500">${dbCount}</span><br>
                        TOTAL NOMINAL: <span style="color:#0088ff">${formatCurrency(totalAmount)}</span>
                    `;
                } else {
                    outputText.value = '';
                    statsInfo.innerHTML = 'STATUS: <span style="color:#ff3366">TIDAK DITEMUKAN TRANSAKSI</span>';
                }
            }
            
            function formatCurrency(amount) {
                return 'Rp ' + amount.toLocaleString('id-ID');
            }
            
            async function copyToClipboard() {
                if (!outputText.value.trim()) {
                    showNotification('Tidak ada data untuk disalin!', 'error');
                    return;
                }
                
                copyBtn.classList.add('transform-click');
                setTimeout(() => copyBtn.classList.remove('transform-click'), 300);
                
                try {
                    await navigator.clipboard.writeText(outputText.value);
                    showNotification('Berhasil disalin ke clipboard!', 'success');
                } catch (err) {
                    outputText.select();
                    outputText.setSelectionRange(0, 99999);
                    
                    try {
                        document.execCommand('copy');
                        showNotification('Berhasil disalin ke clipboard!', 'success');
                    } catch (e) {
                        showNotification('Gagal menyalin ke clipboard!', 'error');
                    }
                }
            }
            
            function showNotification(message, type = 'success') {
                notificationText.textContent = message;
                notification.className = 'notification';
                notification.classList.add('show');
                notification.classList.add(`notification-${type}`);
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            function clearInput() {
                inputData.value = '';
                outputText.value = '';
                debugInfo.innerHTML = '';
                debugInfo.style.display = 'none';
                statsInfo.innerHTML = 'STATUS: MENUNGGU INPUT DATA...';
                showNotification('Input telah dibersihkan!', 'success');
                
                clearBtn.classList.add('transform-click');
                setTimeout(() => clearBtn.classList.remove('transform-click'), 300);
            }
            
            function loadSample() {
                inputData.value = `PEND
TRSF E-BANKING DB
2201/FTSCY/WS95271
20000000.00
ACHMAD FAUZAN ARIF
0000
20,000,000.00
DB
2,521,382.00
PEND
TRSF E-BANKING CR
2201/FTSCY/WS95031
100000.00
AGUS MULIAWAN, A.M
0000
100,000.00
CR
2,621,382.00
PEND
BI-FAST CR
TANGGAL :22/01 TRANSFER DR 008 SIBENG SISWANTO
0000
40,000,212.00
CR
42,621,594.00
PEND
TRSF E-BANKING CR
2201/FTSCY/WS95031
300000.00
MARHASURUNGAN SIHO
0000
300,000.00
CR
42,921,594.00
PEND
SETORAN VIA CDM
TANGGAL :22/01 22/01 WSID:Z9PP1 YUDI PURNO NUGROHO
0998
100,000.00
CR
43,021,594.00
PEND
TRSF E-BANKING CR
2201/FTSCY/WS95271
250701.00
HASRUN
0000
250,701.00
CR
43,272,295.00
PEND`;
                
                parseData();
                showNotification('Data contoh telah dimuat!', 'success');
                
                loadSampleBtn.classList.add('transform-click');
                setTimeout(() => loadSampleBtn.classList.remove('transform-click'), 300);
            }
            
            function testBIFast() {
                const testData = `BI-FAST CR
TANGGAL :22/01 TRANSFER DR 008 SIBENG SISWANTO
0000
40,000,212.00
CR
42,621,594.00
PEND`;
                
                inputData.value = testData;
                parseData();
                showNotification('Test BI-FAST dijalankan!', 'success');
                
                debugInfo.style.display = 'block';
                
                testBtn.classList.add('transform-click');
                setTimeout(() => testBtn.classList.remove('transform-click'), 300);
            }
            
            // Event listeners
            parseBtn.addEventListener('click', parseData);
            clearBtn.addEventListener('click', clearInput);
            loadSampleBtn.addEventListener('click', loadSample);
            copyBtn.addEventListener('click', copyToClipboard);
            testBtn.addEventListener('click', testBIFast);
            filterType.addEventListener('change', parseData);
            
            // Parse on load
            parseData();
        });
    </script>
</body>
</html>
